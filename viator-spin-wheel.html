<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Viator Travel Agents ‚Äì Spin to Win!</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* =============================================
   DESIGN TOKENS
   ============================================= */
:root {
  --purple:   #8d37ff;
  --green:    #00c295;
  --pink:     #ff2579;
  --orange:   #f86148;
  --cyan:     #00d6db;
  --viator:   #008768;
  --white:    #ffffff;

  /* Light theme */
  --bg:          #f0f7f5;
  --bg2:         #ffffff;
  --surface:     #ffffff;
  --surface2:    #f7fbf9;
  --border:      #d6ece6;
  --border-mid:  #b2d9cf;
  --text:        #0d2b22;
  --text-mid:    #3a6357;
  --text-dim:    #6b9e92;
  --text-dimmer: #9dbfb8;

  --shadow-sm:  0 1px 4px rgba(0,87,68,0.07), 0 2px 8px rgba(0,87,68,0.05);
  --shadow-md:  0 4px 16px rgba(0,87,68,0.10), 0 8px 32px rgba(0,87,68,0.07);
  --shadow-lg:  0 8px 32px rgba(0,87,68,0.12), 0 20px 56px rgba(0,87,68,0.08);

  --font: 'Inter', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* =============================================
   BACKGROUND ‚Äî soft teal tint, airy
   ============================================= */
.bg-canvas {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 70% 50% at 0% 40%,   rgba(0,135,104,0.08) 0%, transparent 65%),
    radial-gradient(ellipse 60% 60% at 100% 70%,  rgba(0,194,149,0.07) 0%, transparent 65%),
    radial-gradient(ellipse 50% 40% at 50%  0%,   rgba(0,214,219,0.05) 0%, transparent 60%),
    var(--bg);
}

/* Subtle floating icons ‚Äî very light on white bg */
.particles { position: fixed; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
.particle {
  position: absolute; border-radius: 50%; opacity: 0;
  animation: drift linear infinite;
}
@keyframes drift {
  0%   { transform: translateY(105vh) translateX(0) scale(0.5); opacity: 0; }
  5%   { opacity: 0.35; }
  95%  { opacity: 0.2; }
  100% { transform: translateY(-10vh) translateX(var(--dx,0px)) scale(1.3); opacity: 0; }
}

.float-icons { position: fixed; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
.float-icon {
  position: absolute; opacity: 0;
  animation: iconFloat linear infinite;
}
@keyframes iconFloat {
  0%   { transform: translateY(110vh) rotate(0deg); opacity: 0; }
  8%   { opacity: 0.12; }
  92%  { opacity: 0.12; }
  100% { transform: translateY(-15vh) rotate(360deg); opacity: 0; }
}

.tap-logo {
  display: block; height: 30px; width: auto;
}
.tap-logo svg {
  height: 30px; width: auto; display: block;
}

.event-pill {
  background: rgba(255,255,255,0.15);
  border: 1.5px solid rgba(255,255,255,0.3);
  border-radius: 100px; padding: 5px 12px;
  font-size: 0.66rem; font-weight: 700; color: var(--white);
  letter-spacing: 1px; text-transform: uppercase;
  display: flex; align-items: center; gap: 7px;
  flex-shrink: 0;
}
.event-pill .dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: rgba(255,255,255,0.9);
  animation: blink 2s ease-in-out infinite; flex-shrink: 0;
}
@keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

/* =============================================
   PAGE LAYOUT
   ============================================= */
.page {
  position: relative; z-index: 5;
  display: flex; flex-direction: column; align-items: center;
  padding: 24px 16px 60px; gap: 20px;
}

/* =============================================
   HERO BANNER ‚Äî full-width Viator green
   ============================================= */
.hero-banner {
  width: 100%; background: var(--viator);
  padding: 20px 20px 28px;
  position: relative; overflow: hidden;
}
.hero-banner::before {
  content: '';position:absolute;inset:0;
  background: linear-gradient(135deg, rgba(0,194,149,0.3) 0%, transparent 55%),
              linear-gradient(225deg, rgba(0,214,219,0.15) 0%, transparent 50%);
  pointer-events: none;
}
.hero-banner::after {
  content: '';position:absolute;bottom:-1px;left:0;right:0;height:24px;
  background: var(--bg);
  clip-path: ellipse(55% 100% at 50% 100%);
}

.banner-top {
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 20px; position: relative; z-index: 1;
  gap: 12px;
}

.hero {
  text-align: center; position: relative; z-index: 1;
}
.hero h1 {
  font-size: clamp(1.35rem, 4.5vw, 2.2rem);
  font-weight: 900; line-height: 1.12; letter-spacing: -0.4px;
  color: var(--white); margin-bottom: 10px;
}
.hero h1 .accent { color: #a8fce8; }
.hero p {
  font-size: 0.85rem; color: rgba(255,255,255,0.82);
  line-height: 1.6; max-width: 520px; margin: 0 auto;
}
.hero p strong { color: #a8fce8; font-weight: 700; }

.hero-event-name {
  margin-top: 14px;
  font-size: 1rem; font-weight: 700;
  color: rgba(255,255,255,0.95);
  letter-spacing: 0.5px;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 100px;
  display: inline-block;
  padding: 5px 16px;
}

/* =============================================
   STATS ROW
   ============================================= */
.stats-row {
  display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; width: 100%;
}
.stat-chip {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 14px; padding: 12px 20px;
  text-align: center; flex: 1 1 110px; max-width: 160px;
  box-shadow: var(--shadow-sm);
}
.stat-val   { font-size: 1.3rem; font-weight: 800; color: var(--viator); letter-spacing: -0.5px; }
.stat-val.p { color: var(--purple); }
.stat-label { font-size: 0.6rem; font-weight: 700; color: var(--text-dimmer); text-transform: uppercase; letter-spacing: 1.2px; margin-top: 3px; }

/* =============================================
   SETUP NOTICE
   ============================================= */
.setup-notice {
  background: #fff8f0; border: 1.5px solid #fad5b8;
  border-radius: 12px; padding: 14px 18px;
  max-width: 640px; width: 100%;
  font-size: 0.78rem; line-height: 1.65; color: #7a4a20;
}
.setup-notice strong { color: var(--orange); font-weight: 700; display: block; margin-bottom: 5px; font-size: 0.85rem; }
.setup-notice ol { padding-left: 16px; margin-top: 5px; }
.setup-notice li { margin-bottom: 3px; }
.setup-notice code { background: rgba(0,0,0,0.06); border-radius: 4px; padding: 1px 6px; font-size: 0.75rem; color: #c0531a; font-family: monospace; }

/* =============================================
   GAME AREA
   ============================================= */
.game-wrap {
  display: flex; flex-direction: column; align-items: center;
  gap: 20px; width: 100%; max-width: 900px;
}
/* Mobile: wheel smaller so both fit on screen */
@media (max-width: 679px) {
  .game-wrap { gap: 16px; }
  .wheel-wrap { --wsize: min(240px, calc(100vw - 80px)) !important; }
  .hub-circle { width: 36px; height: 36px; font-size: 0.9rem; }
  .wheel-pointer { border-left-width: 10px; border-right-width: 10px; border-top-width: 22px; top: -10px; }
}
@media (min-width: 680px) {
  .game-wrap { flex-direction: row; align-items: flex-start; justify-content: center; }
}

/* =============================================
   WHEEL COLUMN
   ============================================= */
.wheel-col {
  display: flex; flex-direction: column; align-items: center; gap: 18px;
  flex-shrink: 0;
}

.wheel-wrap {
  position: relative;
  --wsize: min(310px, calc(100vw - 52px));
  width: var(--wsize); height: var(--wsize);
}
@media (min-width: 680px) { .wheel-wrap { --wsize: 340px; } }

.wheel-glow {
  position: absolute; inset: -20px; border-radius: 50%; z-index: 0;
  background: radial-gradient(circle, rgba(0,135,104,0.14) 0%, transparent 68%);
  animation: glow 3s ease-in-out infinite;
}
@keyframes glow { 0%,100%{transform:scale(1);opacity:0.8;} 50%{transform:scale(1.1);opacity:1;} }

.wheel-orbit {
  position: absolute; inset: -9px; border-radius: 50%;
  border: 2px solid rgba(0,135,104,0.2); z-index: 1;
  animation: orbit 18s linear infinite;
}
.wheel-orbit::before, .wheel-orbit::after {
  content:''; position:absolute; width:8px; height:8px; border-radius:50%;
  background: var(--viator); box-shadow: 0 0 8px rgba(0,135,104,0.5);
  top:-4px; left:calc(50% - 4px);
}
.wheel-orbit::after { top:auto; bottom:-4px; }
@keyframes orbit { to { transform: rotate(360deg); } }

.wheel-pointer {
  position: absolute; top: -13px; left: 50%; transform: translateX(-50%);
  width:0; height:0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-top: 28px solid var(--viator);
  filter: drop-shadow(0 2px 6px rgba(0,135,104,0.4));
  z-index: 10;
}

canvas#wheelCanvas {
  display: block; width: 100%; height: 100%;
  border-radius: 50%; position: relative; z-index: 2;
  box-shadow: 0 4px 24px rgba(0,135,104,0.15), 0 16px 48px rgba(0,87,68,0.12);
}

/* Locked overlay */
.wheel-lock {
  position: absolute; inset: 0; z-index: 8; border-radius: 50%;
  background: rgba(240,247,245,0.82);
  backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 8px;
  transition: opacity 0.35s, visibility 0.35s;
}
.wheel-lock.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.lock-icon { font-size: 1.9rem; }
.lock-msg {
  font-size: 0.65rem; font-weight: 700;
  color: var(--text-mid); letter-spacing: 0.8px;
  text-transform: uppercase; text-align: center; padding: 0 16px; line-height: 1.6;
}

.wheel-hub {
  position: absolute; inset: 0; z-index: 9;
  display: flex; align-items: center; justify-content: center; pointer-events: none;
}
.hub-circle {
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--white); border: 3px solid var(--viator);
  box-shadow: 0 2px 12px rgba(0,135,104,0.25);
  display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
}

.prize-chips { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
.pchip {
  background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 100px; padding: 5px 12px;
  font-size: 0.7rem; font-weight: 600; color: var(--text-mid);
  display: flex; align-items: center; gap: 5px;
  box-shadow: var(--shadow-sm);
}
.pchip.sp { border-color: rgba(141,55,255,0.25); color: var(--purple); background: rgba(141,55,255,0.05); }

/* =============================================
   FORM CARD
   ============================================= */
.form-card {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 20px; padding: 30px 26px;
  width: 100%; max-width: 400px;
  box-shadow: var(--shadow-lg);
  flex-shrink: 0;
}
.form-card h2 { font-size: 1.25rem; font-weight: 800; letter-spacing: -0.3px; margin-bottom: 4px; color: var(--text); }
.form-sub { font-size: 0.8rem; color: var(--text-dim); margin-bottom: 22px; line-height: 1.55; }

.fields { display: flex; flex-direction: column; gap: 13px; margin-bottom: 18px; }

.field { display: flex; flex-direction: column; gap: 5px; }
.field label {
  font-size: 0.65rem; font-weight: 700;
  color: var(--text-mid); letter-spacing: 1px; text-transform: uppercase;
}
.field input[type="text"],
.field input[type="email"] {
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 10px; padding: 11px 14px;
  color: var(--text); font-size: 0.9rem; font-family: var(--font); font-weight: 500;
  outline: none;
  transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
  -webkit-appearance: none;
}
.field input:focus {
  border-color: var(--viator); background: #f0faf7;
  box-shadow: 0 0 0 3px rgba(0,135,104,0.1);
}
.field input::placeholder { color: var(--text-dimmer); font-weight: 400; }

/* Agent toggle */
.agent-toggle-wrap {
  display: flex; flex-direction: column; gap: 6px;
}
.agent-toggle-label {
  font-size: 0.65rem; font-weight: 700;
  color: var(--text-mid); letter-spacing: 1px; text-transform: uppercase;
}
.agent-toggle {
  display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
}
.agent-opt {
  position: relative;
}
.agent-opt input[type="radio"] {
  position: absolute; opacity: 0; width: 0; height: 0;
}
.agent-opt label {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 4px; padding: 12px 8px;
  background: var(--surface2); border: 2px solid var(--border);
  border-radius: 12px; cursor: pointer; text-align: center;
  transition: all 0.18s; text-transform: none; letter-spacing: 0;
  font-size: 0.82rem; font-weight: 600; color: var(--text-mid);
  line-height: 1.3;
}
.agent-opt label .opt-icon { font-size: 1.4rem; }
.agent-opt label .opt-sub { font-size: 0.68rem; font-weight: 400; color: var(--text-dimmer); }
.agent-opt input:checked + label {
  border-color: var(--viator); background: #edf7f4; color: var(--viator);
  box-shadow: 0 0 0 3px rgba(0,135,104,0.1);
}
.agent-opt input:checked + label .opt-sub { color: var(--text-mid); }
.agent-opt label:hover { border-color: var(--border-mid); background: #f4faf8; }

/* =============================================
   SPIN BUTTON
   ============================================= */
.spin-btn {
  width: 100%; padding: 14px 22px;
  border: none; border-radius: 12px;
  background: var(--viator);
  color: var(--white); font-size: 0.97rem; font-weight: 800; font-family: var(--font);
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0,135,104,0.35), 0 2px 6px rgba(0,135,104,0.2);
  transition: transform 0.18s, box-shadow 0.18s;
  display: flex; align-items: center; justify-content: center; gap: 9px;
  position: relative; overflow: hidden;
}
.spin-btn::after {
  content:''; position:absolute; inset:0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 55%);
  opacity:0; transition: opacity 0.2s;
}
.spin-btn:hover::after { opacity: 1; }
.spin-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,135,104,0.45); }
.spin-btn:active { transform: translateY(0); }
.spin-btn:disabled {
  background: var(--border); box-shadow: none;
  cursor: not-allowed; transform: none; color: var(--text-dimmer);
}
.spin-btn:disabled::after { display: none; }
.btn-icon { font-size: 1.05rem; }
.spin-btn:not(:disabled) .btn-icon { animation: spinIco 3s linear infinite; }
@keyframes spinIco { to { transform: rotate(360deg); } }

.form-legal { margin-top: 12px; font-size: 0.65rem; color: var(--text-dimmer); text-align: center; line-height: 1.55; }

/* =============================================
   RESULT OVERLAY
   ============================================= */
.overlay {
  display: none; position: fixed; inset: 0; z-index: 100;
  background: rgba(220,240,236,0.75);
  backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
  align-items: center; justify-content: center;
  padding: 16px; overflow-y: auto;
}
.overlay.show { display: flex; }

.result-card {
  background: var(--white); border: 1.5px solid var(--border);
  border-radius: 24px; padding: 38px 32px;
  max-width: 460px; width: 100%; text-align: center;
  box-shadow: var(--shadow-lg);
  position: relative; overflow: hidden;
  animation: popIn 0.42s cubic-bezier(0.34,1.56,0.64,1) both;
  margin: auto;
}
@keyframes popIn { from{transform:scale(0.6);opacity:0;} to{transform:scale(1);opacity:1;} }

.result-card.grand { border-color: rgba(141,55,255,0.3); background: #fdf8ff; }
.result-card::before {
  content:''; position:absolute; top:0; left:0; right:0; height:5px;
  background: var(--viator);
  pointer-events:none;
}
.result-card.grand::before { background: var(--purple); }

.res-emoji { font-size: 3.2rem; margin-bottom: 14px; display: block; }
.result-card h2 { font-size: 1.65rem; font-weight: 900; letter-spacing: -0.5px; margin-bottom: 10px; color: var(--text); }
.result-card.grand h2 { color: var(--purple); }
.result-card p { font-size: 0.87rem; color: var(--text-dim); line-height: 1.6; margin-bottom: 22px; }

.code-box {
  background: #f0faf7; border: 2px dashed var(--border-mid);
  border-radius: 14px; padding: 18px 22px; margin-bottom: 14px;
}
.result-card.grand .code-box { background: #faf5ff; border-color: rgba(141,55,255,0.3); }
.code-label { font-size: 0.6rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dimmer); margin-bottom: 8px; }
.code-val { font-size: 1.55rem; font-weight: 800; letter-spacing: 3px; color: var(--viator); word-break: break-all; }
.result-card.grand .code-val { color: var(--purple); }
.code-expiry { font-size: 0.68rem; color: var(--text-dimmer); margin-top: 7px; }

.result-actions {
  display: flex; gap: 8px; justify-content: center; margin-bottom: 18px; flex-wrap: wrap;
}

.copy-btn {
  background: none; border: 1.5px solid var(--border-mid);
  border-radius: 100px; padding: 7px 18px;
  color: var(--text-mid); font-size: 0.78rem; font-weight: 600; font-family: var(--font);
  cursor: pointer; transition: all 0.2s;
}
.copy-btn:hover { border-color: var(--viator); color: var(--viator); background: #f0faf7; }

.email-btn {
  background: none; border: 1.5px solid var(--border-mid);
  border-radius: 100px; padding: 7px 18px;
  color: var(--text-mid); font-size: 0.78rem; font-weight: 600; font-family: var(--font);
  cursor: pointer; transition: all 0.2s;
}
.email-btn:hover { border-color: var(--viator); color: var(--viator); background: #f0faf7; }
.email-btn:disabled { opacity: 0.5; cursor: default; }

.done-btn {
  width: 100%; padding: 13px 22px;
  background: var(--viator); border: none; border-radius: 12px;
  color: var(--white); font-size: 0.92rem; font-weight: 800; font-family: var(--font);
  cursor: pointer; box-shadow: 0 4px 16px rgba(0,135,104,0.35);
  transition: transform 0.18s, box-shadow 0.18s;
  display: block; text-align: center; text-decoration: none;
}
.done-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,135,104,0.45); }

/* =============================================
   CONFETTI
   ============================================= */
.cf {
  position: fixed; pointer-events: none; z-index: 200;
  animation: cfFall linear forwards; border-radius: 2px;
}
@keyframes cfFall {
  0%  { transform: translateY(-10px) rotate(0deg); opacity: 1; }
  100%{ transform: translateY(105vh) rotate(720deg); opacity: 0; }
}

/* =============================================
   TOAST
   ============================================= */
.toast {
  position: fixed; bottom: 20px; left: 50%;
  transform: translateX(-50%) translateY(65px);
  background: var(--text); border-radius: 100px;
  padding: 10px 20px; font-size: 0.8rem; font-weight: 600;
  color: var(--white); z-index: 300;
  transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1);
  white-space: nowrap; pointer-events: none;
  box-shadow: var(--shadow-md);
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* =============================================
   MOBILE FINE-TUNE
   ============================================= */
@media (max-width: 679px) {
  .page { padding: 16px 12px 40px; gap: 16px; }
  .hero-banner { padding: 16px 16px 26px; }
  .hero h1 { font-size: 1.25rem; }
  .hero p { font-size: 0.8rem; }
  .tap-logo { height: 28px; }
  .form-card { padding: 20px 16px; border-radius: 16px; }
  .result-card { padding: 24px 18px; border-radius: 18px; }
  .code-val { font-size: 1.15rem; letter-spacing: 2px; }
  .result-card h2 { font-size: 1.35rem; }
  .stats-row { gap: 7px; }
  .stat-chip { padding: 10px 12px; }
  .stat-val { font-size: 1.1rem; }
}
</style>
</head>
<body>

<div class="bg-canvas"></div>
<div class="particles" id="particles"></div>
<div class="float-icons" id="floatIcons"></div>

<!-- HERO BANNER ‚Äî full width green, no separate header -->
<div class="hero-banner">
  <div class="banner-top">
    <div class="tap-logo"><svg width="203" height="30" viewBox="0 0 203 30" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1562_520)">
<path d="M86.0911 20.6568C86.7592 20.6568 87.2841 21.2332 87.2841 21.9057C87.2841 22.5782 86.7592 23.1546 86.0911 23.1546C85.423 23.1546 84.898 22.5782 84.898 21.9057C84.898 21.2332 85.423 20.6568 86.0911 20.6568ZM86.0911 20.4887C85.3037 20.4887 84.6594 21.1372 84.6594 21.9297C84.6594 22.7223 85.3037 23.3708 86.0911 23.3708C86.8785 23.3708 87.5228 22.7223 87.5228 21.9297C87.5228 21.1372 86.8785 20.4887 86.0911 20.4887ZM86.282 21.9538C86.449 21.9057 86.5922 21.7856 86.5922 21.5695C86.5922 21.3053 86.3774 21.1852 86.0434 21.1852H85.6377V21.4013V22.4101V22.6262H85.8763V22.4101V21.9778H86.0672L86.3774 22.4581C86.4729 22.6022 86.4967 22.6262 86.616 22.6262H86.7353V22.6022L86.282 21.9538ZM86.0195 21.9297H85.8525V21.2813H85.9956C86.2343 21.2813 86.3297 21.3773 86.3297 21.6175C86.3536 21.8337 86.282 21.9297 86.0195 21.9297Z" fill="white"/>
<path d="M24.3861 6.0782H19.0889V23.3708H24.3861V6.0782Z" fill="white"/>
<path d="M53.3058 21.6415C51.7549 21.6415 51.0152 20.7048 51.0152 19.0957V7.51925H55.2147V6.0782H51.0152V1.75506H45.9327L45.6941 6.0782H43.4273V7.51925H45.6703V18.9035C45.6703 21.8337 47.3405 23.7551 50.7527 23.7551C53.3058 23.7551 54.833 22.6983 55.4533 21.2813L55.2147 21.0171C54.8568 21.3293 54.1648 21.6415 53.3058 21.6415Z" fill="white"/>
<path d="M64.3536 5.69392C58.7224 5.69392 55.1432 9.63279 55.1432 14.8206C55.1432 19.9363 58.4838 23.7791 64.2343 23.7791C70.1042 23.7791 73.4447 19.8402 73.4447 14.6524C73.4447 9.5127 69.961 5.69392 64.3536 5.69392ZM64.3059 22.5061C61.4664 22.5061 61.0846 20.2005 61.0846 14.6765C61.0846 9.24851 61.4664 6.8948 64.282 6.8948C67.1215 6.8948 67.5033 9.24851 67.5033 14.7485C67.5033 20.1524 67.1454 22.5061 64.3059 22.5061Z" fill="white"/>
<path d="M80.8416 9.05638L80.7223 6.07821H75.5922V23.3708H80.8893V9.51271C81.1757 9.44066 81.4859 9.34459 81.8677 9.34459C82.7982 9.34459 83.8959 9.72887 87.2126 11.29L87.5228 11.1699V6.3424C87.0217 5.95812 86.2581 5.66991 85.4468 5.66991C83.9436 5.69393 82.2256 6.63061 80.8416 9.05638Z" fill="white"/>
<path d="M36.603 21.3053L37.1996 23.3708H41.7332V10.0651C41.7332 7.13497 39.4425 5.69392 35.6724 5.69392C33.1432 5.69392 30.0412 6.39043 27.8937 7.11095L27.6551 10.1131L27.9653 10.2813C31.9978 7.54327 33.2147 6.91881 34.4555 6.91881C35.8872 6.91881 36.4837 7.66336 36.4837 9.22449V12.8271C30.4946 14.076 26.8438 14.9887 26.8438 19.0957C26.8438 21.9057 28.705 23.7791 31.7115 23.7791C33.9783 23.7551 35.6963 22.6743 36.603 21.3053ZM32.0455 18.0869C32.0455 15.421 32.9284 14.7725 36.4837 14.028V20.6808C35.9349 21.1612 35.1714 21.4254 34.2408 21.4254C32.7137 21.4254 32.0455 20.5607 32.0455 18.0869Z" fill="white"/>
<path d="M13.6724 12.2027C15.4515 12.2027 16.8937 10.751 16.8937 8.9603C16.8937 7.16959 15.4515 5.71794 13.6724 5.71794C11.8934 5.71794 10.4512 7.16959 10.4512 8.9603C10.4512 10.751 11.8934 12.2027 13.6724 12.2027Z" fill="white"/>
<path d="M10.1171 23.3708L11.7874 19.576L5.82212 6.0782H0.190887L7.82646 23.3708H10.1171Z" fill="white"/>
<g clip-path="url(#clip1_1562_520)">
<path d="M86.0838 20.6746C86.3345 20.6621 86.5831 20.7255 86.7975 20.8566C87.012 20.9877 87.1825 21.1804 87.287 21.41C87.3915 21.6395 87.4253 21.8953 87.3839 22.1443C87.3425 22.3933 87.2279 22.6241 87.0548 22.8069C86.8817 22.9898 86.6582 23.1162 86.413 23.17C86.1678 23.2237 85.9123 23.2022 85.6793 23.1084C85.4464 23.0146 85.2467 22.8526 85.1062 22.6435C84.9656 22.4343 84.8906 22.1876 84.8907 21.9351C84.883 21.6088 85.0044 21.2928 85.2281 21.0565C85.4518 20.8201 85.7596 20.6828 86.0838 20.6746V20.6746ZM86.0838 20.4945C85.8007 20.4945 85.5239 20.579 85.2884 20.7373C85.053 20.8956 84.8695 21.1206 84.7611 21.3838C84.6527 21.6471 84.6244 21.9367 84.6796 22.2162C84.7349 22.4956 84.8712 22.7523 85.0714 22.9538C85.2717 23.1552 85.5268 23.2924 85.8045 23.348C86.0823 23.4036 86.3701 23.3751 86.6318 23.266C86.8934 23.157 87.117 22.9724 87.2743 22.7355C87.4316 22.4986 87.5156 22.22 87.5156 21.9351C87.5156 21.5531 87.3648 21.1866 87.0962 20.9165C86.8277 20.6463 86.4636 20.4945 86.0838 20.4945ZM86.2914 21.9663C86.3785 21.9488 86.4569 21.9019 86.5138 21.8333C86.5707 21.7647 86.6025 21.6787 86.604 21.5894C86.604 21.3253 86.3774 21.2148 86.0528 21.2148H85.6376V22.6554H85.8762V22.0072H86.0671L86.3678 22.4873C86.4633 22.6386 86.48 22.6482 86.6064 22.6482H86.7281V22.6338L86.2914 21.9663ZM86.0337 21.9423H85.8715V21.2797H86.017C86.2557 21.2797 86.3535 21.3709 86.3535 21.6086C86.3535 21.8463 86.2867 21.9303 86.0337 21.9303V21.9423Z" fill="white"/>
<path d="M24.3707 6.07677H19.0852V23.3637H24.3707V6.07677Z" fill="white"/>
<path d="M53.3135 21.635C51.7601 21.635 51.0203 20.6962 51.0203 19.0924V7.51735H55.2178V6.07677H51.0203V1.75504H45.9424L45.7038 6.07677H43.4512V7.51735H45.7038V18.9051C45.7038 21.8391 47.3742 23.7526 50.796 23.7526C53.3613 23.7526 54.8789 22.6986 55.4993 21.2917L55.2607 21.018C54.6959 21.4317 54.0121 21.6484 53.3135 21.635V21.635Z" fill="white"/>
<path d="M64.3571 5.68542C58.7208 5.68542 55.1438 9.635 55.1438 14.8091C55.1438 19.9303 58.4845 23.7622 64.2402 23.7622C70.1103 23.7622 73.4511 19.8151 73.4511 14.6506C73.4511 9.51975 69.9529 5.68542 64.3571 5.68542ZM64.3189 22.5041C61.4793 22.5041 61.0879 20.1944 61.0879 14.6722C61.0879 9.23644 61.4745 6.8883 64.2736 6.8883C67.1108 6.8883 67.4998 9.23644 67.4998 14.749C67.5046 20.156 67.1562 22.5041 64.3189 22.5041V22.5041Z" fill="white"/>
<path d="M80.8484 9.04917L80.7315 6.07678H75.6011V23.3637H80.8938V9.51976C81.2113 9.41909 81.5417 9.3657 81.8745 9.36129C82.8171 9.36129 83.9148 9.75265 87.2102 11.3181L87.5228 11.2004V6.35049C86.9142 5.90678 86.1791 5.67344 85.4276 5.68542C83.9458 5.68542 82.2205 6.6242 80.8484 9.04917Z" fill="white"/>
<path d="M36.5931 21.2917L37.2016 23.3637H41.7235V10.0672C41.7235 7.1332 39.4303 5.68542 35.66 5.68542C33.133 5.68542 30.0237 6.3889 27.8857 7.09478L27.647 10.1056L27.9596 10.2616C32.0019 7.52455 33.2094 6.9003 34.4502 6.9003C35.882 6.9003 36.4714 7.6446 36.4714 9.20762V12.8091C30.4867 14.06 26.8309 14.9699 26.8309 19.066C26.8309 21.8823 28.697 23.7598 31.6917 23.7598C33.9897 23.755 35.6982 22.6602 36.5931 21.2917ZM32.0449 18.084C32.0449 15.4237 32.9397 14.7586 36.4761 14.0167V20.6746C35.8373 21.1864 35.0371 21.4505 34.2211 21.4189C32.7059 21.4093 32.0449 20.5474 32.0449 18.084Z" fill="white"/>
<path d="M13.6613 12.1992C15.4404 12.1992 16.8827 10.748 16.8827 8.95793C16.8827 7.16781 15.4404 5.71663 13.6613 5.71663C11.8821 5.71663 10.4398 7.16781 10.4398 8.95793C10.4398 10.748 11.8821 12.1992 13.6613 12.1992Z" fill="white"/>
<path d="M10.1153 23.3637L11.7976 19.563L5.82959 6.07677H0.178955L7.82926 23.3637H10.1153Z" fill="white"/>
</g>
</g>
<path d="M114.524 10.618V11.654H111.864V20.376H110.59V11.654H107.916V10.618H114.524ZM117.366 13.95C117.59 13.5113 117.907 13.1706 118.318 12.928C118.738 12.6853 119.247 12.564 119.844 12.564V13.88H119.508C118.08 13.88 117.366 14.6546 117.366 16.204V20.376H116.092V12.704H117.366V13.95ZM120.839 16.512C120.839 15.728 120.997 15.042 121.315 14.454C121.632 13.8566 122.066 13.3946 122.617 13.068C123.177 12.7413 123.797 12.578 124.479 12.578C125.151 12.578 125.734 12.7226 126.229 13.012C126.723 13.3013 127.092 13.6653 127.335 14.104V12.704H128.623V20.376H127.335V18.948C127.083 19.396 126.705 19.7693 126.201 20.068C125.706 20.3573 125.127 20.502 124.465 20.502C123.783 20.502 123.167 20.334 122.617 19.998C122.066 19.662 121.632 19.1906 121.315 18.584C120.997 17.9773 120.839 17.2866 120.839 16.512ZM127.335 16.526C127.335 15.9473 127.218 15.4433 126.985 15.014C126.751 14.5846 126.434 14.258 126.033 14.034C125.641 13.8006 125.207 13.684 124.731 13.684C124.255 13.684 123.821 13.796 123.429 14.02C123.037 14.244 122.724 14.5706 122.491 15C122.257 15.4293 122.141 15.9333 122.141 16.512C122.141 17.1 122.257 17.6133 122.491 18.052C122.724 18.4813 123.037 18.8126 123.429 19.046C123.821 19.27 124.255 19.382 124.731 19.382C125.207 19.382 125.641 19.27 126.033 19.046C126.434 18.8126 126.751 18.4813 126.985 18.052C127.218 17.6133 127.335 17.1046 127.335 16.526ZM133.632 19.2L136.012 12.704H137.37L134.36 20.376H132.876L129.866 12.704H131.238L133.632 19.2ZM145.623 16.246C145.623 16.4886 145.609 16.7453 145.581 17.016H139.449C139.496 17.772 139.752 18.3646 140.219 18.794C140.695 19.214 141.269 19.424 141.941 19.424C142.492 19.424 142.949 19.298 143.313 19.046C143.686 18.7846 143.948 18.4393 144.097 18.01H145.469C145.264 18.7473 144.853 19.3493 144.237 19.816C143.621 20.2733 142.856 20.502 141.941 20.502C141.213 20.502 140.56 20.3386 139.981 20.012C139.412 19.6853 138.964 19.2233 138.637 18.626C138.31 18.0193 138.147 17.3193 138.147 16.526C138.147 15.7326 138.306 15.0373 138.623 14.44C138.94 13.8426 139.384 13.3853 139.953 13.068C140.532 12.7413 141.194 12.578 141.941 12.578C142.669 12.578 143.313 12.7366 143.873 13.054C144.433 13.3713 144.862 13.81 145.161 14.37C145.469 14.9206 145.623 15.546 145.623 16.246ZM144.307 15.98C144.307 15.4946 144.2 15.0793 143.985 14.734C143.77 14.3793 143.476 14.1133 143.103 13.936C142.739 13.7493 142.333 13.656 141.885 13.656C141.241 13.656 140.69 13.8613 140.233 14.272C139.785 14.6826 139.528 15.252 139.463 15.98H144.307ZM148.579 10.016V20.376H147.305V10.016H148.579ZM160.251 18.206H155.995L155.211 20.376H153.867L157.395 10.674H158.865L162.379 20.376H161.035L160.251 18.206ZM159.887 17.17L158.123 12.242L156.359 17.17H159.887ZM167.08 12.578C167.743 12.578 168.321 12.7226 168.816 13.012C169.32 13.3013 169.693 13.6653 169.936 14.104V12.704H171.224V20.544C171.224 21.244 171.075 21.8646 170.776 22.406C170.477 22.9566 170.048 23.386 169.488 23.694C168.937 24.002 168.293 24.156 167.556 24.156C166.548 24.156 165.708 23.918 165.036 23.442C164.364 22.966 163.967 22.3173 163.846 21.496H165.106C165.246 21.9626 165.535 22.336 165.974 22.616C166.413 22.9053 166.94 23.05 167.556 23.05C168.256 23.05 168.825 22.8306 169.264 22.392C169.712 21.9533 169.936 21.3373 169.936 20.544V18.934C169.684 19.382 169.311 19.7553 168.816 20.054C168.321 20.3526 167.743 20.502 167.08 20.502C166.399 20.502 165.778 20.334 165.218 19.998C164.667 19.662 164.233 19.1906 163.916 18.584C163.599 17.9773 163.44 17.2866 163.44 16.512C163.44 15.728 163.599 15.042 163.916 14.454C164.233 13.8566 164.667 13.3946 165.218 13.068C165.778 12.7413 166.399 12.578 167.08 12.578ZM169.936 16.526C169.936 15.9473 169.819 15.4433 169.586 15.014C169.353 14.5846 169.035 14.258 168.634 14.034C168.242 13.8006 167.808 13.684 167.332 13.684C166.856 13.684 166.422 13.796 166.03 14.02C165.638 14.244 165.325 14.5706 165.092 15C164.859 15.4293 164.742 15.9333 164.742 16.512C164.742 17.1 164.859 17.6133 165.092 18.052C165.325 18.4813 165.638 18.8126 166.03 19.046C166.422 19.27 166.856 19.382 167.332 19.382C167.808 19.382 168.242 19.27 168.634 19.046C169.035 18.8126 169.353 18.4813 169.586 18.052C169.819 17.6133 169.936 17.1046 169.936 16.526ZM180.377 16.246C180.377 16.4886 180.363 16.7453 180.335 17.016H174.203C174.25 17.772 174.506 18.3646 174.973 18.794C175.449 19.214 176.023 19.424 176.695 19.424C177.246 19.424 177.703 19.298 178.067 19.046C178.44 18.7846 178.702 18.4393 178.851 18.01H180.223C180.018 18.7473 179.607 19.3493 178.991 19.816C178.375 20.2733 177.61 20.502 176.695 20.502C175.967 20.502 175.314 20.3386 174.735 20.012C174.166 19.6853 173.718 19.2233 173.391 18.626C173.064 18.0193 172.901 17.3193 172.901 16.526C172.901 15.7326 173.06 15.0373 173.377 14.44C173.694 13.8426 174.138 13.3853 174.707 13.068C175.286 12.7413 175.948 12.578 176.695 12.578C177.423 12.578 178.067 12.7366 178.627 13.054C179.187 13.3713 179.616 13.81 179.915 14.37C180.223 14.9206 180.377 15.546 180.377 16.246ZM179.061 15.98C179.061 15.4946 178.954 15.0793 178.739 14.734C178.524 14.3793 178.23 14.1133 177.857 13.936C177.493 13.7493 177.087 13.656 176.639 13.656C175.995 13.656 175.444 13.8613 174.987 14.272C174.539 14.6826 174.282 15.252 174.217 15.98H179.061ZM185.797 12.564C186.73 12.564 187.486 12.8486 188.065 13.418C188.643 13.978 188.933 14.79 188.933 15.854V20.376H187.673V16.036C187.673 15.2706 187.481 14.6873 187.099 14.286C186.716 13.8753 186.193 13.67 185.531 13.67C184.859 13.67 184.322 13.88 183.921 14.3C183.529 14.72 183.333 15.3313 183.333 16.134V20.376H182.059V12.704H183.333V13.796C183.585 13.404 183.925 13.1006 184.355 12.886C184.793 12.6713 185.274 12.564 185.797 12.564ZM192.568 13.754V18.276C192.568 18.6493 192.647 18.9153 192.806 19.074C192.964 19.2233 193.24 19.298 193.632 19.298H194.57V20.376H193.422C192.712 20.376 192.18 20.2126 191.826 19.886C191.471 19.5593 191.294 19.0226 191.294 18.276V13.754H190.3V12.704H191.294V10.772H192.568V12.704H194.57V13.754H192.568ZM198.829 20.502C198.241 20.502 197.714 20.404 197.247 20.208C196.781 20.0026 196.412 19.7226 196.141 19.368C195.871 19.004 195.721 18.5886 195.693 18.122H197.009C197.047 18.5046 197.224 18.8173 197.541 19.06C197.868 19.3026 198.293 19.424 198.815 19.424C199.301 19.424 199.683 19.3166 199.963 19.102C200.243 18.8873 200.383 18.6166 200.383 18.29C200.383 17.954 200.234 17.7066 199.935 17.548C199.637 17.38 199.175 17.2166 198.549 17.058C197.98 16.9086 197.513 16.7593 197.149 16.61C196.795 16.4513 196.487 16.2226 196.225 15.924C195.973 15.616 195.847 15.2146 195.847 14.72C195.847 14.328 195.964 13.9686 196.197 13.642C196.431 13.3153 196.762 13.0586 197.191 12.872C197.621 12.676 198.111 12.578 198.661 12.578C199.511 12.578 200.197 12.7926 200.719 13.222C201.242 13.6513 201.522 14.2393 201.559 14.986H200.285C200.257 14.5846 200.094 14.2626 199.795 14.02C199.506 13.7773 199.114 13.656 198.619 13.656C198.162 13.656 197.798 13.754 197.527 13.95C197.257 14.146 197.121 14.4026 197.121 14.72C197.121 14.972 197.201 15.182 197.359 15.35C197.527 15.5086 197.733 15.6393 197.975 15.742C198.227 15.8353 198.573 15.9426 199.011 16.064C199.562 16.2133 200.01 16.3626 200.355 16.512C200.701 16.652 200.995 16.8666 201.237 17.156C201.489 17.4453 201.62 17.8233 201.629 18.29C201.629 18.71 201.513 19.088 201.279 19.424C201.046 19.76 200.715 20.026 200.285 20.222C199.865 20.4086 199.38 20.502 198.829 20.502Z" fill="white"/>
<line x1="98.4265" y1="3.27835e-08" x2="98.4265" y2="29.474" stroke="white" stroke-width="1.5"/>
<defs>
<clipPath id="clip0_1562_520">
<rect width="88" height="22" fill="white" transform="translate(0 1.70703)"/>
</clipPath>
<clipPath id="clip1_1562_520">
<rect width="88" height="22" fill="white" transform="translate(0 1.70703)"/>
</clipPath>
</defs>
</svg></div>
  </div>
  <div class="hero">
    <h1>Unlock Your Exclusive Event Offer<br><span class="accent">&amp; Win Up to $250</span></h1>
    <p>Register below to spin for a chance to win up to a <strong>$250 travel voucher</strong> and receive your event-only promo code.</p>
    <div id="heroEventName" class="hero-event-name" style="display:none;"></div>
    <div class="event-pill" id="heroPill" style="display:none;margin-top:14px;justify-content:center;"><span class="dot"></span><span id="eventLabel">Loading‚Ä¶</span></div>
  </div>
</div>

<!-- PAGE -->
<main class="page">

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-chip">
      <div class="stat-val" id="statSpins">0</div>
      <div class="stat-label">Spins Today</div>
    </div>
    <div class="stat-chip">
      <div class="stat-val p" id="statGrand">‚Äì / 2</div>
      <div class="stat-label">$250 Left</div>
    </div>
    <div class="stat-chip">
      <div class="stat-val" id="statEvent" style="font-size:0.82rem;padding-top:5px;">‚Äì</div>
      <div class="stat-label">Event</div>
    </div>
    <div class="stat-chip" id="statDateChip" style="display:none;">
      <div class="stat-val" id="statDates" style="font-size:0.72rem;padding-top:4px;color:var(--cyan);">‚Äì</div>
      <div class="stat-label">Event Dates</div>
    </div>
  </div>

  <!-- SETUP NOTICE -->
  <div class="setup-notice" id="setupNotice">
    <strong>‚öôÔ∏è Almost live ‚Äî one step remaining, then set SHOW_SETUP_NOTICE = false</strong>
    <ol>
      <li>‚úÖ <b>CSV connected</b> ‚Äî your sheet is live at the published URL.</li>
      <li>‚úÖ <b>Sheet format matched</b> ‚Äî reads columns: <code>Promocodes</code> ¬∑ <code>Value</code> ¬∑ <code>Event</code> ¬∑ <code>Event Dates</code></li>
      <li>‚úÖ <b>Event filtering active</b> ‚Äî QR codes use <code>?event=EventName</code> to load only that event's codes. Event name must match exactly what's in the <code>Event</code> column.</li>
      <li>‚¨ú <b>Email capture:</b> Create a Google Apps Script Web App (code in HTML comments below), paste deployment URL into <code>APPS_SCRIPT_URL</code>.</li>
    </ol>
  </div>

  <!-- GAME AREA -->
  <div class="game-wrap">

    <!-- WHEEL -->
    <div class="wheel-col">
      <div class="wheel-wrap">
        <div class="wheel-glow"></div>
        <div class="wheel-orbit"></div>
        <div class="wheel-pointer"></div>
        <canvas id="wheelCanvas"></canvas>
        <div class="wheel-lock" id="wheelLock">
          <div class="lock-icon">üîí</div>
          <div class="lock-msg">Fill in your details<br>to unlock the wheel</div>
        </div>
        <div class="wheel-hub"><div class="hub-circle">‚úàÔ∏è</div></div>
      </div>
      <div class="prize-chips">
        <div class="pchip">üéüÔ∏è 10% Off Promo</div>
        <div class="pchip sp">‚≠ê $250 Voucher √ó2</div>
      </div>
    </div>

    <!-- FORM -->
    <div class="form-card">
      <h2>Claim Your Spin ‚ú®</h2>
      <p class="form-sub">Enter your details to unlock the wheel and claim your exclusive deal.</p>
      <div class="fields">
        <div class="field">
          <label>Full Name</label>
          <input type="text" id="fName" placeholder="Jane Smith" autocomplete="name">
        </div>
        <div class="field">
          <label>Agency Name</label>
          <input type="text" id="fAgency" placeholder="Sunrise Travel Co." autocomplete="organization">
        </div>
        <div class="field">
          <label>Email Address</label>
          <input type="email" id="fEmail" placeholder="jane@sunrisetravel.com" autocomplete="email">
        </div>
        <div class="agent-toggle-wrap">
          <span class="agent-toggle-label">Your Viator Status</span>
          <div class="agent-toggle">
            <div class="agent-opt">
              <input type="radio" name="agentStatus" id="fIsNew" value="new">
              <label for="fIsNew">
                <span class="opt-icon">‚ú®</span>
                New to Viator
                <span class="opt-sub">I'd like to sign up</span>
              </label>
            </div>
            <div class="agent-opt">
              <input type="radio" name="agentStatus" id="fIsAgent" value="existing">
              <label for="fIsAgent">
                <span class="opt-icon">üèÖ</span>
                Existing Agent
                <span class="opt-sub">Already a partner</span>
              </label>
            </div>
          </div>
        </div>
      </div>
      <button class="spin-btn" id="spinBtn" onclick="handleSpin()">
        <span class="btn-icon">üåÄ</span> Spin the Wheel!
      </button>
      <p class="form-legal">One spin per person ¬∑ Promo codes are event-specific and non-transferable<br>By submitting your details you agree to receive email communications from Viator regarding exclusive offers, promotions, and travel agent program updates. You may unsubscribe at any time.</p>
    </div>

  </div><!-- /game-wrap -->
</main>

<!-- RESULT OVERLAY -->
<div class="overlay" id="overlay">
  <div class="result-card" id="resultCard">
    <span class="res-emoji" id="resEmoji">üéâ</span>
    <h2 id="resTitle">You won!</h2>
    <p id="resMsg"></p>
    <div class="code-box">
      <div class="code-label">Your Promo Code</div>
      <div class="code-val" id="resCode">‚Äî‚Äî</div>
      <div class="code-expiry" id="resExpiry"></div>
    </div>
    <div class="result-actions">
      <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
      <button class="email-btn" id="emailCodeBtn" onclick="emailCode()">üìß Email Me My Code</button>
    </div>
    <a href="https://www.travelagents.viator.com" target="_blank" class="done-btn" onclick="closeResult()">Start Booking Today ‚úàÔ∏è</a>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* =================================================
   CONFIG
   ================================================= */
const CFG = {
  SHOW_SETUP_NOTICE: false,

  // Published Google Sheet CSV ‚Äî 4 columns: Promocodes | Value | Event | Event Dates
  // Value is "10% off" or "$250 voucher". Event must match the ?event= URL param.
  SHEET_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRN6Enjcymi6mkbC50vCvxCuF1f4iwYQFE7BO1onoKbaClaxn1AAJG0Uafz4TnJH5Wl81-wlGppzRsc/pub?gid=0&single=true&output=csv',

  // Google Apps Script Web App URL for email logging.
  APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbynkU7w6Ly1j5G6U2oN_7sbN3XeorEMkfzUNdc0UrSPCIXwZYdLEjSgoaP6xOMS9a_N/exec',

  GRAND_PRIZES_PER_EVENT: 2,
};

const SEGMENTS = [
  { label: '10%\nOff!',     color: '#008768', type: '10pct'      },
  { label: '10%\nOff!',     color: '#00c295', type: '10pct'      },
  { label: '$250\nVoucher', color: '#8d37ff', type: 'grand_prize' },
  { label: '10%\nOff!',     color: '#00d6db', type: '10pct'      },
  { label: '10%\nOff!',     color: '#008768', type: '10pct'      },
  { label: '10%\nOff!',     color: '#f86148', type: '10pct'      },
  { label: '$250\nVoucher', color: '#8d37ff', type: 'grand_prize' },
  { label: '10%\nOff!',     color: '#00c295', type: '10pct'      },
];

/* =================================================
   STATE
   ================================================= */
let codes       = { '10pct': [], 'grand_prize': [] };
let grandGiven  = 0;
let spinCount   = 0;
let spinning    = false;
let wheelAngle  = 0;
let currentCode = '';
let eventId     = '';
let eventDates  = '';

/* =================================================
   INIT
   ================================================= */
document.addEventListener('DOMContentLoaded', () => {
  if (!CFG.SHOW_SETUP_NOTICE) {
    const n = document.getElementById('setupNotice');
    if (n) n.remove();
  }

  // URL param still supported as override, but auto-detection happens after CSV loads
  const params = new URLSearchParams(window.location.search);
  eventId = (params.get('event') || '').toUpperCase().trim();

  buildBg();
  initWheel();
  loadCodes();

  ['fName','fAgency','fEmail'].forEach(id =>
    document.getElementById(id).addEventListener('input', checkReady)
  );
  document.querySelectorAll('input[name="agentStatus"]').forEach(r =>
    r.addEventListener('change', checkReady)
  );
  checkReady();
});

/* =================================================
   BACKGROUND
   ================================================= */
function buildBg() {
  const COLORS = ['#8d37ff','#00c295','#ff2579','#f86148','#00d6db','#008768'];
  const ICONS  = ['‚úàÔ∏è','üó∫Ô∏è','üåç','üèùÔ∏è','üß≥','üå¥','üö¢','üèîÔ∏è','‚õµ','üé°','üå∫','üçπ','ü¶ã','üé≠'];

  const pc = document.getElementById('particles');
  for (let i = 0; i < 20; i++) {
    const el = document.createElement('div');
    el.className = 'particle';
    const s = 3 + Math.random() * 6;
    Object.assign(el.style, {
      width: s+'px', height: s+'px',
      left: Math.random()*100+'%',
      background: COLORS[i % COLORS.length],
      animationDuration: (13+Math.random()*22)+'s',
      animationDelay: (Math.random()*22)+'s',
      '--dx': ((Math.random()-.5)*110)+'px',
      opacity: 0,
    });
    pc.appendChild(el);
  }

  const fi = document.getElementById('floatIcons');
  for (let i = 0; i < 14; i++) {
    const el = document.createElement('div');
    el.className = 'float-icon';
    el.textContent = ICONS[Math.floor(Math.random()*ICONS.length)];
    Object.assign(el.style, {
      left: Math.random()*100+'%',
      fontSize: (1.1+Math.random()*1.3)+'rem',
      animationDuration: (14+Math.random()*22)+'s',
      animationDelay: (Math.random()*28)+'s',
    });
    fi.appendChild(el);
  }
}

/* =================================================
   WHEEL
   ================================================= */
function initWheel() {
  const canvas = document.getElementById('wheelCanvas');
  const dpr    = window.devicePixelRatio || 1;
  function resize() {
    const size = canvas.parentElement.offsetWidth || 300;
    canvas.width  = size * dpr;
    canvas.height = size * dpr;
    canvas.style.width  = size+'px';
    canvas.style.height = size+'px';
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    drawWheel(wheelAngle);
  }
  resize();
  window.addEventListener('resize', resize);
}

function drawWheel(angle) {
  const canvas = document.getElementById('wheelCanvas');
  const dpr    = window.devicePixelRatio || 1;
  const size   = parseInt(canvas.style.width) || (canvas.width / dpr);
  const ctx    = canvas.getContext('2d');
  ctx.clearRect(0, 0, size, size);

  const cx  = size / 2, cy = size / 2, r = size / 2 - 3;
  const arc = (2 * Math.PI) / SEGMENTS.length;

  ctx.save();
  ctx.beginPath(); ctx.arc(cx, cy, r, 0, 2*Math.PI); ctx.clip();

  SEGMENTS.forEach((seg, i) => {
    const start = angle + i * arc - Math.PI/2;
    const end   = start + arc;
    const mid   = start + arc/2;

    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath();
    ctx.fillStyle = seg.color; ctx.fill();

    // Sheen
    const g = ctx.createRadialGradient(cx,cy,r*.25,cx,cy,r);
    g.addColorStop(0,'rgba(255,255,255,0.16)');
    g.addColorStop(1,'rgba(0,0,0,0.10)');
    ctx.fillStyle = g; ctx.fill();

    // Divider
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath();
    ctx.strokeStyle = 'rgba(255,255,255,0.18)'; ctx.lineWidth = 1.5; ctx.stroke();

    // Label
    ctx.save();
    ctx.translate(cx,cy); ctx.rotate(mid);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#ffffff';
    ctx.shadowColor = 'rgba(0,0,0,0.65)'; ctx.shadowBlur = 5;
    const fs    = Math.max(10, size * (seg.type==='grand_prize' ? 0.042 : 0.039));
    ctx.font    = `800 ${fs}px Inter, sans-serif`;
    const lines = seg.label.split('\n');
    const lh    = fs * 1.28;
    lines.forEach((line, li) => {
      ctx.fillText(line, r - size*0.044, (li-(lines.length-1)/2)*lh + fs*0.36);
    });
    ctx.restore();
  });

  ctx.restore();

  ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI);
  ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.lineWidth=3; ctx.stroke();
}

/* =================================================
   LOAD CODES
   Sheet: Promocodes | Value | Event | Event Dates
   Value:  "10% off" ‚Üí 10pct  |  "$250 voucher" ‚Üí grand_prize
   Event:  must match ?event= URL param (case-insensitive)
   ================================================= */
async function loadCodes() {
  try {
    const r = await fetch(CFG.SHEET_CSV_URL);
    if (!r.ok) throw new Error('HTTP ' + r.status);
    parseCSV(await r.text());
    console.log(`[Viator] Loaded ${codes['10pct'].length} discount + ${codes['grand_prize'].length} grand prize codes for "${eventId}"`);
  } catch(e) {
    console.warn('Sheet load failed, using demo codes:', e);
    loadDemoCodes();
  }
}

function loadDemoCodes() {
  // Mirrors your actual sheet data as fallback
  [
    { code:'hyhskjkn', type:'10pct'       },
    { code:'hk76hhl',  type:'10pct'       },
    { code:'hik86h',   type:'10pct'       },
    { code:'kgikbl',   type:'10pct'       },
    { code:'lsh9kb',   type:'10pct'       },
    { code:'shojmkl',  type:'grand_prize' },
    { code:'kohinkl',  type:'grand_prize' },
  ].forEach(({ code, type }) => {
    codes[type].push({
      code,
      validity: type === 'grand_prize' ? 'Redeemable at viator.com ¬∑ This event only' : 'Valid 30 days ¬∑ This event only'
    });
  });
  refreshStats();
}

/* =================================================
   DATE PARSING
   Parses "April 21-26 2026" or "April 21-May 3 2026"
   Returns { start: Date, end: Date } or null
   ================================================= */
function parseEventDateRange(str) {
  if (!str) return null;
  const MONTHS = { january:0,february:1,march:2,april:3,may:4,june:5,
                   july:6,august:7,september:8,october:9,november:10,december:11 };

  str = str.trim();

  // "April 21-26 2026" ‚Äî same month
  let m = str.match(/^(\w+)\s+(\d+)-(\d+)\s+(\d{4})$/i);
  if (m) {
    const mo = MONTHS[m[1].toLowerCase()];
    if (mo === undefined) return null;
    const yr = parseInt(m[4]);
    return {
      start: new Date(yr, mo, parseInt(m[2])),
      end:   new Date(yr, mo, parseInt(m[3]))
    };
  }

  // "April 21 - May 3 2026" ‚Äî cross month
  m = str.match(/^(\w+)\s+(\d+)\s*-\s*(\w+)\s+(\d+)\s+(\d{4})$/i);
  if (m) {
    const mo1 = MONTHS[m[1].toLowerCase()];
    const mo2 = MONTHS[m[3].toLowerCase()];
    if (mo1 === undefined || mo2 === undefined) return null;
    const yr = parseInt(m[5]);
    return {
      start: new Date(yr, mo1, parseInt(m[2])),
      end:   new Date(yr, mo2, parseInt(m[4]))
    };
  }

  return null;
}

function isDateInRange(range) {
  if (!range) return false;
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const end = new Date(range.end);
  end.setHours(23, 59, 59, 999);
  return today >= range.start && today <= end;
}

function parseCSV(text) {
  const rows = text.replace(/\r/g, '').trim().split('\n');

  // Detect column positions from header row
  const hdr    = rows[0].toLowerCase().split(',').map(v => v.trim().replace(/^"|"$/g,''));
  const iCode  = hdr.findIndex(h => h.includes('promo'));
  const iVal   = hdr.findIndex(h => h.includes('value'));
  const iEvent = hdr.findIndex(h => h === 'event');
  const iDates = hdr.findIndex(h => h.includes('date'));

  const cCode  = iCode  >= 0 ? iCode  : 0;
  const cVal   = iVal   >= 0 ? iVal   : 1;
  const cEvent = iEvent >= 0 ? iEvent : 2;
  const cDates = iDates >= 0 ? iDates : 3;

  // First pass: collect all unique events with their date ranges
  const allEvents = {};
  rows.slice(1).forEach(row => {
    if (!row.trim()) return;
    const parts = parseCSVRow(row);
    const evnt  = (parts[cEvent] || '').trim();
    const dates = (parts[cDates] || '').trim();
    if (evnt && dates && !allEvents[evnt]) {
      allEvents[evnt] = { name: evnt, dates, range: parseEventDateRange(dates) };
    }
  });

  // If no URL param, auto-detect current event by today's date
  if (!eventId) {
    for (const ev of Object.values(allEvents)) {
      if (isDateInRange(ev.range)) {
        eventId  = ev.name.toUpperCase();
        eventDates = ev.dates;
        break;
      }
    }
  }

  // Second pass: load codes for matched event (or blank-event fallback rows)
  rows.slice(1).forEach(row => {
    if (!row.trim()) return;
    const parts = parseCSVRow(row);
    const code  = (parts[cCode]  || '').trim();
    const val   = (parts[cVal]   || '').toLowerCase().trim();
    const evnt  = (parts[cEvent] || '').trim().toUpperCase();
    const dates = (parts[cDates] || '').trim();

    if (!code) return;

    // Load if: matches current event, OR event cell is blank (demo/fallback)
    if (evnt && evnt !== eventId) return;

    if (dates && !eventDates) eventDates = dates;

    const validity = eventDates ? `Valid for: ${eventDates}` : 'Valid for this event only';

    if (val.includes('250') || val.includes('voucher')) {
      codes['grand_prize'].push({ code, validity: `$250 Viator Voucher ¬∑ ${validity}` });
    } else if (val.includes('10') || val.includes('off') || val.includes('discount')) {
      codes['10pct'].push({ code, validity });
    }
  });

  updateEventDisplay();
  refreshStats();
}

// Proper CSV row parser that handles quoted fields containing commas
function parseCSVRow(row) {
  const result = [];
  let cur = '', inQuote = false;
  for (let i = 0; i < row.length; i++) {
    const ch = row[i];
    if (ch === '"') { inQuote = !inQuote; }
    else if (ch === ',' && !inQuote) { result.push(cur.trim()); cur = ''; }
    else { cur += ch; }
  }
  result.push(cur.trim());
  return result;
}

function updateEventDisplay() {
  // Find the event name from the raw event column (preserve original casing)
  // eventId is uppercased internally, so find the display name from allEvents if possible
  const displayName = eventId || '';
  const pill = document.getElementById('heroPill');
  const labelEl = document.getElementById('eventLabel');
  const statEl  = document.getElementById('statEvent');
  const datesEl = document.getElementById('statDates');
  const chipEl  = document.getElementById('statDateChip');

  if (displayName) {
    if (labelEl) labelEl.textContent = displayName;
    if (statEl)  statEl.textContent  = displayName;
    if (pill)    { pill.style.display = 'inline-flex'; }

    // Show event name prominently in the hero banner
    const heroEvent = document.getElementById('heroEventName');
    if (heroEvent) {
      heroEvent.textContent = displayName;
      heroEvent.style.display = 'block';
    }
  } else {
    if (pill) pill.style.display = 'none';
    const chip3 = document.querySelector('.stat-chip:nth-child(3)');
    if (chip3) chip3.style.display = 'none';
  }

  if (eventDates) {
    if (datesEl) datesEl.textContent = eventDates;
    if (chipEl)  chipEl.style.display = '';
  }
}

function refreshStats() {
  document.getElementById('statGrand').textContent = `${codes['grand_prize'].length} / ${CFG.GRAND_PRIZES_PER_EVENT}`;
}

/* =================================================
   FORM CHECK
   ================================================= */
function checkReady() {
  const name   = document.getElementById('fName').value.trim();
  const agency = document.getElementById('fAgency').value.trim();
  const email  = document.getElementById('fEmail').value.trim();
  const status = document.querySelector('input[name="agentStatus"]:checked');
  const ok     = name.length>0 && agency.length>0 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) && !!status;
  document.getElementById('spinBtn').disabled = !ok;
  document.getElementById('wheelLock').classList.toggle('hidden', ok);
}

function validateForm() {
  if (!document.getElementById('fName').value.trim())              { showToast('Please enter your name ‚úçÔ∏è');         return false; }
  if (!document.getElementById('fAgency').value.trim())            { showToast('Please enter your agency üè¢');       return false; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(document.getElementById('fEmail').value.trim()))
                                                                    { showToast('Please enter a valid email üìß');     return false; }
  if (!document.querySelector('input[name="agentStatus"]:checked')) { showToast('Please select your Viator status'); return false; }
  return true;
}

/* =================================================
   SPIN
   ================================================= */
async function handleSpin() {
  if (spinning) return;
  if (!validateForm()) return;

  // Scroll wheel into view before spinning
  document.getElementById('wheelCanvas').scrollIntoView({ behavior: 'smooth', block: 'center' });

  spinning = true;
  document.getElementById('spinBtn').disabled = true;
  document.getElementById('wheelLock').classList.remove('hidden');

  const prize  = choosePrize();
  const segIdx = pickSeg(prize);
  await animateSpin(segIdx);

  const codeObj = dispense(prize);
  currentCode   = codeObj ? codeObj.code : 'SEE-STAFF';
  spinCount++;
  document.getElementById('statSpins').textContent = spinCount;

  await logEntry(prize, codeObj);

  setTimeout(() => {
    showResult(prize, codeObj);
    if (prize==='grand_prize') fireConfetti();
  }, 450);
}

function choosePrize() {
  if (codes['grand_prize'].length>0 && grandGiven<CFG.GRAND_PRIZES_PER_EVENT && Math.random()<(codes['grand_prize'].length/25)) {
    grandGiven++; return 'grand_prize';
  }
  return '10pct';
}

function pickSeg(prizeType) {
  const m = SEGMENTS.map((s,i)=>s.type===prizeType?i:-1).filter(i=>i>=0);
  return m[Math.floor(Math.random()*m.length)];
}

function animateSpin(targetIdx) {
  return new Promise(resolve => {
    const arc        = (2*Math.PI)/SEGMENTS.length;
    const segMid     = targetIdx*arc + arc/2;
    const spins      = (5+Math.floor(Math.random()*4))*2*Math.PI;
    const norm       = ((wheelAngle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
    const toTarget   = ((spins-segMid)-norm+2*Math.PI)%(2*Math.PI);
    const finalAngle = wheelAngle + toTarget + spins;
    const duration   = 4200 + Math.random()*1400;
    const startAngle = wheelAngle;
    const t0         = performance.now();

    const ease = x => 1-Math.pow(1-x,4);

    (function frame(now) {
      const p = Math.min((now-t0)/duration, 1);
      wheelAngle = startAngle + (finalAngle-startAngle)*ease(p);
      drawWheel(wheelAngle);
      if (p<1) requestAnimationFrame(frame);
      else { spinning=false; resolve(); }
    })(t0);
  });
}

function dispense(prizeType) {
  if (codes[prizeType].length>0) return codes[prizeType].shift();
  return codes['10pct'].shift() || null;
}

/* =================================================
   SHOW RESULT
   ================================================= */
function showResult(prizeType, codeObj) {
  const fname = document.getElementById('fName').value.trim().split(' ')[0];
  const code  = codeObj ? codeObj.code : 'SEE-STAFF';
  const card  = document.getElementById('resultCard');

  document.getElementById('resCode').textContent   = code;
  document.getElementById('resExpiry').textContent = codeObj ? codeObj.validity : '';
  currentCode = code;

  if (prizeType==='grand_prize') {
    card.className='result-card grand';
    document.getElementById('resEmoji').textContent = 'üèÜ';
    document.getElementById('resTitle').textContent = 'JACKPOT! $250 Voucher!';
    document.getElementById('resMsg').textContent   = `Incredible, ${fname}! You've won a $250 Viator voucher ‚Äî one of only 2 at this event!`;
  } else {
    card.className='result-card';
    const phrases=['Bon Voyage!','Happy Travels!','Adventure Awaits!','You\'re a Winner!'];
    document.getElementById('resEmoji').textContent = 'üéüÔ∏è';
    document.getElementById('resTitle').textContent = phrases[spinCount % phrases.length];
    document.getElementById('resMsg').textContent   = `Here's your exclusive 10% off code, ${fname}! Use it at travelagents.viator.com when booking your next experience.`;
  }

  document.getElementById('overlay').classList.add('show');
}

function closeResult() {
  document.getElementById('overlay').classList.remove('show');
  ['fName','fAgency','fEmail'].forEach(id=>document.getElementById(id).value='');
  document.querySelectorAll('input[name="agentStatus"]').forEach(r => r.checked = false);
  checkReady();
  refreshStats();
}

function copyCode() {
  navigator.clipboard.writeText(currentCode)
    .then(()=>showToast('Copied to clipboard! üìã'))
    .catch(()=>showToast('Long-press the code to copy'));
}

async function emailCode() {
  const btn   = document.getElementById('emailCodeBtn');
  const email = document.getElementById('fEmail').value.trim();
  const name  = document.getElementById('fName').value.trim().split(' ')[0];
  const code  = currentCode;
  const expiry = document.getElementById('resExpiry').textContent;

  btn.disabled = true;
  btn.textContent = '‚è≥ Sending‚Ä¶';

  const data = {
    action:    'sendCode',
    email, name, code, expiry,
    event: eventId,
  };

  try {
    await fetch(CFG.APPS_SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    btn.textContent = '‚úÖ Sent!';
    showToast('Code emailed to ' + email + ' üìß');
  } catch(e) {
    btn.disabled = false;
    btn.textContent = 'üìß Email Me My Code';
    showToast('Could not send ‚Äî please copy the code instead');
  }
}

/* =================================================
   LOG SIGN-UP
   ================================================= */
async function logEntry(prizeType, codeObj) {
  const data = {
    timestamp: new Date().toISOString(),
    event:     eventId,
    name:      document.getElementById('fName').value.trim(),
    agency:    document.getElementById('fAgency').value.trim(),
    email:     document.getElementById('fEmail').value.trim(),
    isViatorAgent: document.querySelector('input[name="agentStatus"]:checked')?.value === 'existing',
    agentStatus:   document.querySelector('input[name="agentStatus"]:checked')?.value || 'not specified',
    prizeType,
    code: codeObj ? codeObj.code : '',
  };

  if (CFG.APPS_SCRIPT_URL==='YOUR_APPS_SCRIPT_URL_HERE') {
    console.log('[Demo] Would log:', data); return;
  }
  try {
    await fetch(CFG.APPS_SCRIPT_URL, {
      method:'POST', mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data),
    });
  } catch(e) { console.warn('Log failed:', e); }
}

/* =================================================
   CONFETTI
   ================================================= */
function fireConfetti() {
  const C=['#8d37ff','#00c295','#ff2579','#f86148','#00d6db','#ffffff'];
  for (let i=0;i<90;i++) {
    const el=document.createElement('div');
    el.className='cf';
    const w=6+Math.random()*10, h=8+Math.random()*14;
    Object.assign(el.style,{
      left: Math.random()*100+'vw', top:'-15px',
      width: w+'px', height: h+'px',
      background: C[Math.floor(Math.random()*C.length)],
      borderRadius: Math.random()>.4?'50%':'2px',
      animationDuration: (2+Math.random()*3)+'s',
      animationDelay: (Math.random()*1.2)+'s',
    });
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 5500);
  }
}

/* =================================================
   TOAST
   ================================================= */
function showToast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2800);
}
</script>

<!--
=====================================================
GOOGLE APPS SCRIPT ‚Äî Captures sign-ups + sends code emails
=====================================================
1. Open (or create) a Google Sheet for responses.
2. Go to Extensions ‚Üí Apps Script.
3. Paste ALL the code below, replacing any existing code.
4. Click Deploy ‚Üí New Deployment ‚Üí Web App.
   Execute as: Me | Who has access: Anyone
5. Copy the Web App URL ‚Üí paste into CFG.APPS_SCRIPT_URL above.

IMPORTANT: After updating this code, you must create a NEW deployment
(not just save) for changes to take effect.

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);

    // Route: email code to attendee
    if (data.action === 'sendCode') {
      return sendCodeEmail(data);
    }

    // Default: log sign-up to sheet
    var ss    = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getSheetByName('Signups') || ss.insertSheet('Signups');

    if (sheet.getLastRow() === 0) {
      sheet.appendRow(['Timestamp','Event','Full Name','Agency','Email','Viator Status','Prize Type','Promo Code']);
      sheet.getRange(1,1,1,8).setFontWeight('bold');
      sheet.setFrozenRows(1);
    }

    sheet.appendRow([
      data.timestamp, data.event, data.name, data.agency, data.email,
      data.agentStatus || (data.isViatorAgent ? 'existing' : 'new'), data.prizeType, data.code
    ]);

    return ContentService
      .createTextOutput(JSON.stringify({status:'ok'}))
      .setMimeType(ContentService.MimeType.JSON);

  } catch(err) {
    return ContentService
      .createTextOutput(JSON.stringify({status:'error',msg:err.message}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function sendCodeEmail(data) {
  var subject = 'Your Viator Promo Code' + (data.event ? ' ‚Äî ' + data.event : '');
  var body = 'Hi ' + data.name + ',\n\n'
    + 'Here is your exclusive Viator promo code from today\'s event:\n\n'
    + '  ' + data.code + '\n\n'
    + (data.expiry ? data.expiry + '\n\n' : '')
    + 'To redeem, visit viator.com and enter your code at checkout.\n\n'
    + 'Happy travels!\n'
    + 'The Viator Travel Agent Team';

  var htmlBody = '<div style="font-family:Arial,sans-serif;max-width:480px;margin:0 auto;">'
    + '<div style="background:#008768;padding:24px 28px;border-radius:12px 12px 0 0;">'
    + '<p style="color:#ffffff;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin:0;">VIATOR TRAVEL AGENTS</p>'
    + '</div>'
    + '<div style="background:#f0faf7;padding:28px;border-radius:0 0 12px 12px;border:1px solid #d6ece6;">'
    + '<p style="font-size:16px;color:#0d2b22;">Hi ' + data.name + ',</p>'
    + '<p style="color:#3a6357;">Here\'s your exclusive Viator promo code from today\'s event:</p>'
    + '<div style="background:#ffffff;border:2px dashed #b2d9cf;border-radius:10px;padding:20px;text-align:center;margin:20px 0;">'
    + '<p style="font-size:11px;font-weight:700;letter-spacing:2px;color:#9dbfb8;text-transform:uppercase;margin:0 0 8px;">YOUR PROMO CODE</p>'
    + '<p style="font-size:26px;font-weight:900;letter-spacing:4px;color:#008768;margin:0;">' + data.code + '</p>'
    + (data.expiry ? '<p style="font-size:11px;color:#9dbfb8;margin:8px 0 0;">' + data.expiry + '</p>' : '')
    + '</div>'
    + '<p style="color:#3a6357;">To redeem, visit <a href="https://viator.com" style="color:#008768;">viator.com</a> and enter your code at checkout.</p>'
    + '<p style="color:#3a6357;">Happy travels!<br><strong>The Viator Travel Agent Team</strong></p>'
    + '</div></div>';

  GmailApp.sendEmail(data.email, subject, body, { htmlBody: htmlBody });

  return ContentService
    .createTextOutput(JSON.stringify({status:'ok'}))
    .setMimeType(ContentService.MimeType.JSON);
}
=====================================================
-->

</body>
</html>
