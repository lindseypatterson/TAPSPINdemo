<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Viator Travel Agents ‚Äì Spin to Win!</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* =============================================
   DESIGN TOKENS ‚Äî Light, clean, Viator brand
   ============================================= */
:root {
  --purple:   #8d37ff;
  --green:    #00c295;
  --pink:     #ff2579;
  --orange:   #f86148;
  --cyan:     #00d6db;
  --viator:   #008768;
  --white:    #ffffff;

  /* Light theme */
  --bg:          #f0f7f5;
  --bg2:         #ffffff;
  --surface:     #ffffff;
  --surface2:    #f7fbf9;
  --border:      #d6ece6;
  --border-mid:  #b2d9cf;
  --text:        #0d2b22;
  --text-mid:    #3a6357;
  --text-dim:    #6b9e92;
  --text-dimmer: #9dbfb8;

  --shadow-sm:  0 1px 4px rgba(0,87,68,0.07), 0 2px 8px rgba(0,87,68,0.05);
  --shadow-md:  0 4px 16px rgba(0,87,68,0.10), 0 8px 32px rgba(0,87,68,0.07);
  --shadow-lg:  0 8px 32px rgba(0,87,68,0.12), 0 20px 56px rgba(0,87,68,0.08);

  --font: 'Inter', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* =============================================
   BACKGROUND ‚Äî soft teal tint, airy
   ============================================= */
.bg-canvas {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 70% 50% at 0% 40%,   rgba(0,135,104,0.08) 0%, transparent 65%),
    radial-gradient(ellipse 60% 60% at 100% 70%,  rgba(0,194,149,0.07) 0%, transparent 65%),
    radial-gradient(ellipse 50% 40% at 50%  0%,   rgba(0,214,219,0.05) 0%, transparent 60%),
    var(--bg);
}

/* Subtle floating icons ‚Äî very light on white bg */
.particles { position: fixed; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
.particle {
  position: absolute; border-radius: 50%; opacity: 0;
  animation: drift linear infinite;
}
@keyframes drift {
  0%   { transform: translateY(105vh) translateX(0) scale(0.5); opacity: 0; }
  5%   { opacity: 0.35; }
  95%  { opacity: 0.2; }
  100% { transform: translateY(-10vh) translateX(var(--dx,0px)) scale(1.3); opacity: 0; }
}

.float-icons { position: fixed; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
.float-icon {
  position: absolute; opacity: 0;
  animation: iconFloat linear infinite;
}
@keyframes iconFloat {
  0%   { transform: translateY(110vh) rotate(0deg); opacity: 0; }
  8%   { opacity: 0.12; }
  92%  { opacity: 0.12; }
  100% { transform: translateY(-15vh) rotate(360deg); opacity: 0; }
}

.tap-logo {
  height: 36px; width: auto; display: block;
  /* logo is dark bg ‚Äî invert to white for green banner */
  filter: brightness(0) invert(1);
}

.event-pill {
  background: rgba(255,255,255,0.15);
  border: 1.5px solid rgba(255,255,255,0.3);
  border-radius: 100px; padding: 5px 12px;
  font-size: 0.66rem; font-weight: 700; color: var(--white);
  letter-spacing: 1px; text-transform: uppercase;
  display: flex; align-items: center; gap: 7px;
  flex-shrink: 0;
}
.event-pill .dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: rgba(255,255,255,0.9);
  animation: blink 2s ease-in-out infinite; flex-shrink: 0;
}
@keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

/* =============================================
   PAGE LAYOUT
   ============================================= */
.page {
  position: relative; z-index: 5;
  display: flex; flex-direction: column; align-items: center;
  padding: 24px 16px 60px; gap: 20px;
}

/* =============================================
   HERO BANNER ‚Äî full-width Viator green
   ============================================= */
.hero-banner {
  width: 100%; background: var(--viator);
  padding: 20px 20px 28px;
  position: relative; overflow: hidden;
}
.hero-banner::before {
  content: '';position:absolute;inset:0;
  background: linear-gradient(135deg, rgba(0,194,149,0.3) 0%, transparent 55%),
              linear-gradient(225deg, rgba(0,214,219,0.15) 0%, transparent 50%);
  pointer-events: none;
}
.hero-banner::after {
  content: '';position:absolute;bottom:-1px;left:0;right:0;height:24px;
  background: var(--bg);
  clip-path: ellipse(55% 100% at 50% 100%);
}

.banner-top {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 20px; position: relative; z-index: 1;
  gap: 12px;
}

.hero {
  text-align: left; position: relative; z-index: 1;
}
.hero h1 {
  font-size: clamp(1.35rem, 4.5vw, 2.2rem);
  font-weight: 900; line-height: 1.12; letter-spacing: -0.4px;
  color: var(--white); margin-bottom: 10px;
}
.hero h1 .accent { color: #a8fce8; }
.hero p {
  font-size: 0.85rem; color: rgba(255,255,255,0.82);
  line-height: 1.6; max-width: 520px;
}
.hero p strong { color: #a8fce8; font-weight: 700; }

/* =============================================
   STATS ROW
   ============================================= */
.stats-row {
  display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; width: 100%;
}
.stat-chip {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 14px; padding: 12px 20px;
  text-align: center; flex: 1 1 110px; max-width: 160px;
  box-shadow: var(--shadow-sm);
}
.stat-val   { font-size: 1.3rem; font-weight: 800; color: var(--viator); letter-spacing: -0.5px; }
.stat-val.p { color: var(--purple); }
.stat-label { font-size: 0.6rem; font-weight: 700; color: var(--text-dimmer); text-transform: uppercase; letter-spacing: 1.2px; margin-top: 3px; }

/* =============================================
   SETUP NOTICE
   ============================================= */
.setup-notice {
  background: #fff8f0; border: 1.5px solid #fad5b8;
  border-radius: 12px; padding: 14px 18px;
  max-width: 640px; width: 100%;
  font-size: 0.78rem; line-height: 1.65; color: #7a4a20;
}
.setup-notice strong { color: var(--orange); font-weight: 700; display: block; margin-bottom: 5px; font-size: 0.85rem; }
.setup-notice ol { padding-left: 16px; margin-top: 5px; }
.setup-notice li { margin-bottom: 3px; }
.setup-notice code { background: rgba(0,0,0,0.06); border-radius: 4px; padding: 1px 6px; font-size: 0.75rem; color: #c0531a; font-family: monospace; }

/* =============================================
   GAME AREA
   ============================================= */
.game-wrap {
  display: flex; flex-direction: column; align-items: center;
  gap: 20px; width: 100%; max-width: 900px;
}
/* Mobile: wheel smaller so both fit on screen */
@media (max-width: 679px) {
  .game-wrap { gap: 16px; }
  .wheel-wrap { --wsize: min(240px, calc(100vw - 80px)) !important; }
  .hub-circle { width: 36px; height: 36px; font-size: 0.9rem; }
  .wheel-pointer { border-left-width: 10px; border-right-width: 10px; border-top-width: 22px; top: -10px; }
}
@media (min-width: 680px) {
  .game-wrap { flex-direction: row; align-items: flex-start; justify-content: center; }
}

/* =============================================
   WHEEL COLUMN
   ============================================= */
.wheel-col {
  display: flex; flex-direction: column; align-items: center; gap: 18px;
  flex-shrink: 0;
}

.wheel-wrap {
  position: relative;
  --wsize: min(310px, calc(100vw - 52px));
  width: var(--wsize); height: var(--wsize);
}
@media (min-width: 680px) { .wheel-wrap { --wsize: 340px; } }

.wheel-glow {
  position: absolute; inset: -20px; border-radius: 50%; z-index: 0;
  background: radial-gradient(circle, rgba(0,135,104,0.14) 0%, transparent 68%);
  animation: glow 3s ease-in-out infinite;
}
@keyframes glow { 0%,100%{transform:scale(1);opacity:0.8;} 50%{transform:scale(1.1);opacity:1;} }

.wheel-orbit {
  position: absolute; inset: -9px; border-radius: 50%;
  border: 2px solid rgba(0,135,104,0.2); z-index: 1;
  animation: orbit 18s linear infinite;
}
.wheel-orbit::before, .wheel-orbit::after {
  content:''; position:absolute; width:8px; height:8px; border-radius:50%;
  background: var(--viator); box-shadow: 0 0 8px rgba(0,135,104,0.5);
  top:-4px; left:calc(50% - 4px);
}
.wheel-orbit::after { top:auto; bottom:-4px; }
@keyframes orbit { to { transform: rotate(360deg); } }

.wheel-pointer {
  position: absolute; top: -13px; left: 50%; transform: translateX(-50%);
  width:0; height:0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-top: 28px solid var(--viator);
  filter: drop-shadow(0 2px 6px rgba(0,135,104,0.4));
  z-index: 10;
}

canvas#wheelCanvas {
  display: block; width: 100%; height: 100%;
  border-radius: 50%; position: relative; z-index: 2;
  box-shadow: 0 4px 24px rgba(0,135,104,0.15), 0 16px 48px rgba(0,87,68,0.12);
}

/* Locked overlay */
.wheel-lock {
  position: absolute; inset: 0; z-index: 8; border-radius: 50%;
  background: rgba(240,247,245,0.82);
  backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 8px;
  transition: opacity 0.35s, visibility 0.35s;
}
.wheel-lock.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.lock-icon { font-size: 1.9rem; }
.lock-msg {
  font-size: 0.65rem; font-weight: 700;
  color: var(--text-mid); letter-spacing: 0.8px;
  text-transform: uppercase; text-align: center; padding: 0 16px; line-height: 1.6;
}

.wheel-hub {
  position: absolute; inset: 0; z-index: 9;
  display: flex; align-items: center; justify-content: center; pointer-events: none;
}
.hub-circle {
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--white); border: 3px solid var(--viator);
  box-shadow: 0 2px 12px rgba(0,135,104,0.25);
  display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
}

.prize-chips { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
.pchip {
  background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 100px; padding: 5px 12px;
  font-size: 0.7rem; font-weight: 600; color: var(--text-mid);
  display: flex; align-items: center; gap: 5px;
  box-shadow: var(--shadow-sm);
}
.pchip.sp { border-color: rgba(141,55,255,0.25); color: var(--purple); background: rgba(141,55,255,0.05); }

/* =============================================
   FORM CARD
   ============================================= */
.form-card {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 20px; padding: 30px 26px;
  width: 100%; max-width: 400px;
  box-shadow: var(--shadow-lg);
  flex-shrink: 0;
}
.form-card h2 { font-size: 1.25rem; font-weight: 800; letter-spacing: -0.3px; margin-bottom: 4px; color: var(--text); }
.form-sub { font-size: 0.8rem; color: var(--text-dim); margin-bottom: 22px; line-height: 1.55; }

.fields { display: flex; flex-direction: column; gap: 13px; margin-bottom: 18px; }

.field { display: flex; flex-direction: column; gap: 5px; }
.field label {
  font-size: 0.65rem; font-weight: 700;
  color: var(--text-mid); letter-spacing: 1px; text-transform: uppercase;
}
.field input[type="text"],
.field input[type="email"] {
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 10px; padding: 11px 14px;
  color: var(--text); font-size: 0.9rem; font-family: var(--font); font-weight: 500;
  outline: none;
  transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
  -webkit-appearance: none;
}
.field input:focus {
  border-color: var(--viator); background: #f0faf7;
  box-shadow: 0 0 0 3px rgba(0,135,104,0.1);
}
.field input::placeholder { color: var(--text-dimmer); font-weight: 400; }

.check-row {
  display: flex; align-items: flex-start; gap: 11px; cursor: pointer;
  padding: 11px 13px;
  background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 10px; transition: border-color 0.2s, background 0.2s;
}
.check-row:hover { border-color: var(--border-mid); background: #edf7f3; }
.check-row input[type="checkbox"] {
  width: 17px; height: 17px; margin-top: 1px;
  accent-color: var(--viator); cursor: pointer; flex-shrink: 0;
}
.check-row span { font-size: 0.81rem; color: var(--text-mid); line-height: 1.45; }
.check-row strong { color: var(--viator); font-weight: 700; }

/* =============================================
   SPIN BUTTON
   ============================================= */
.spin-btn {
  width: 100%; padding: 14px 22px;
  border: none; border-radius: 12px;
  background: var(--viator);
  color: var(--white); font-size: 0.97rem; font-weight: 800; font-family: var(--font);
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0,135,104,0.35), 0 2px 6px rgba(0,135,104,0.2);
  transition: transform 0.18s, box-shadow 0.18s;
  display: flex; align-items: center; justify-content: center; gap: 9px;
  position: relative; overflow: hidden;
}
.spin-btn::after {
  content:''; position:absolute; inset:0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 55%);
  opacity:0; transition: opacity 0.2s;
}
.spin-btn:hover::after { opacity: 1; }
.spin-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,135,104,0.45); }
.spin-btn:active { transform: translateY(0); }
.spin-btn:disabled {
  background: var(--border); box-shadow: none;
  cursor: not-allowed; transform: none; color: var(--text-dimmer);
}
.spin-btn:disabled::after { display: none; }
.btn-icon { font-size: 1.05rem; }
.spin-btn:not(:disabled) .btn-icon { animation: spinIco 3s linear infinite; }
@keyframes spinIco { to { transform: rotate(360deg); } }

.form-legal { margin-top: 12px; font-size: 0.65rem; color: var(--text-dimmer); text-align: center; line-height: 1.55; }

/* =============================================
   RESULT OVERLAY
   ============================================= */
.overlay {
  display: none; position: fixed; inset: 0; z-index: 100;
  background: rgba(220,240,236,0.75);
  backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
  align-items: center; justify-content: center;
  padding: 16px; overflow-y: auto;
}
.overlay.show { display: flex; }

.result-card {
  background: var(--white); border: 1.5px solid var(--border);
  border-radius: 24px; padding: 38px 32px;
  max-width: 460px; width: 100%; text-align: center;
  box-shadow: var(--shadow-lg);
  position: relative; overflow: hidden;
  animation: popIn 0.42s cubic-bezier(0.34,1.56,0.64,1) both;
  margin: auto;
}
@keyframes popIn { from{transform:scale(0.6);opacity:0;} to{transform:scale(1);opacity:1;} }

.result-card.grand { border-color: rgba(141,55,255,0.3); background: #fdf8ff; }
.result-card::before {
  content:''; position:absolute; top:0; left:0; right:0; height:5px;
  background: var(--viator);
  pointer-events:none;
}
.result-card.grand::before { background: var(--purple); }

.res-emoji { font-size: 3.2rem; margin-bottom: 14px; display: block; }
.result-card h2 { font-size: 1.65rem; font-weight: 900; letter-spacing: -0.5px; margin-bottom: 10px; color: var(--text); }
.result-card.grand h2 { color: var(--purple); }
.result-card p { font-size: 0.87rem; color: var(--text-dim); line-height: 1.6; margin-bottom: 22px; }

.code-box {
  background: #f0faf7; border: 2px dashed var(--border-mid);
  border-radius: 14px; padding: 18px 22px; margin-bottom: 14px;
}
.result-card.grand .code-box { background: #faf5ff; border-color: rgba(141,55,255,0.3); }
.code-label { font-size: 0.6rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dimmer); margin-bottom: 8px; }
.code-val { font-size: 1.55rem; font-weight: 800; letter-spacing: 3px; color: var(--viator); word-break: break-all; }
.result-card.grand .code-val { color: var(--purple); }
.code-expiry { font-size: 0.68rem; color: var(--text-dimmer); margin-top: 7px; }

.copy-btn {
  background: none; border: 1.5px solid var(--border-mid);
  border-radius: 100px; padding: 7px 18px;
  color: var(--text-mid); font-size: 0.78rem; font-weight: 600; font-family: var(--font);
  cursor: pointer; transition: all 0.2s; margin-bottom: 18px;
}
.copy-btn:hover { border-color: var(--viator); color: var(--viator); background: #f0faf7; }

.done-btn {
  width: 100%; padding: 13px 22px;
  background: var(--viator); border: none; border-radius: 12px;
  color: var(--white); font-size: 0.92rem; font-weight: 800; font-family: var(--font);
  cursor: pointer; box-shadow: 0 4px 16px rgba(0,135,104,0.35);
  transition: transform 0.18s, box-shadow 0.18s;
}
.done-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,135,104,0.45); }

/* =============================================
   CONFETTI
   ============================================= */
.cf {
  position: fixed; pointer-events: none; z-index: 200;
  animation: cfFall linear forwards; border-radius: 2px;
}
@keyframes cfFall {
  0%  { transform: translateY(-10px) rotate(0deg); opacity: 1; }
  100%{ transform: translateY(105vh) rotate(720deg); opacity: 0; }
}

/* =============================================
   TOAST
   ============================================= */
.toast {
  position: fixed; bottom: 20px; left: 50%;
  transform: translateX(-50%) translateY(65px);
  background: var(--text); border-radius: 100px;
  padding: 10px 20px; font-size: 0.8rem; font-weight: 600;
  color: var(--white); z-index: 300;
  transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1);
  white-space: nowrap; pointer-events: none;
  box-shadow: var(--shadow-md);
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* =============================================
   MOBILE FINE-TUNE
   ============================================= */
@media (max-width: 679px) {
  .page { padding: 16px 12px 40px; gap: 16px; }
  .hero-banner { padding: 16px 16px 26px; }
  .hero h1 { font-size: 1.25rem; }
  .hero p { font-size: 0.8rem; }
  .tap-logo { height: 28px; }
  .form-card { padding: 20px 16px; border-radius: 16px; }
  .result-card { padding: 24px 18px; border-radius: 18px; }
  .code-val { font-size: 1.15rem; letter-spacing: 2px; }
  .result-card h2 { font-size: 1.35rem; }
  .stats-row { gap: 7px; }
  .stat-chip { padding: 10px 12px; }
  .stat-val { font-size: 1.1rem; }
}
</style>
</head>
<body>

<div class="bg-canvas"></div>
<div class="particles" id="particles"></div>
<div class="float-icons" id="floatIcons"></div>

<!-- HERO BANNER ‚Äî full width green, no separate header -->
<div class="hero-banner">
  <div class="banner-top">
    <img src="data:image/jpeg;base64,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" alt="Viator Travel Agents" class="tap-logo">
    <div class="event-pill"><span class="dot"></span><span id="eventLabel">Loading‚Ä¶</span></div>
  </div>
  <div class="hero">
    <h1>Unlock Your Exclusive<br><span class="accent">Event Offer &amp; Win Up to $250</span></h1>
    <p>Register below to spin for a chance to win up to a <strong>$250 travel voucher</strong> and receive your event-only promo code.</p>
  </div>
</div>

<!-- PAGE -->
<main class="page">

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-chip">
      <div class="stat-val" id="statSpins">0</div>
      <div class="stat-label">Spins Today</div>
    </div>
    <div class="stat-chip">
      <div class="stat-val p" id="statGrand">‚Äì / 2</div>
      <div class="stat-label">$250 Left</div>
    </div>
    <div class="stat-chip">
      <div class="stat-val" id="statEvent" style="font-size:0.82rem;padding-top:5px;">‚Äì</div>
      <div class="stat-label">Event</div>
    </div>
    <div class="stat-chip" id="statDateChip" style="display:none;">
      <div class="stat-val" id="statDates" style="font-size:0.72rem;padding-top:4px;color:var(--cyan);">‚Äì</div>
      <div class="stat-label">Event Dates</div>
    </div>
  </div>

  <!-- SETUP NOTICE -->
  <div class="setup-notice" id="setupNotice">
    <strong>‚öôÔ∏è Almost live ‚Äî one step remaining, then set SHOW_SETUP_NOTICE = false</strong>
    <ol>
      <li>‚úÖ <b>CSV connected</b> ‚Äî your sheet is live at the published URL.</li>
      <li>‚úÖ <b>Sheet format matched</b> ‚Äî reads columns: <code>Promocodes</code> ¬∑ <code>Value</code> ¬∑ <code>Event</code> ¬∑ <code>Event Dates</code></li>
      <li>‚úÖ <b>Event filtering active</b> ‚Äî QR codes use <code>?event=EventName</code> to load only that event's codes. Event name must match exactly what's in the <code>Event</code> column.</li>
      <li>‚¨ú <b>Email capture:</b> Create a Google Apps Script Web App (code in HTML comments below), paste deployment URL into <code>APPS_SCRIPT_URL</code>.</li>
    </ol>
  </div>

  <!-- GAME AREA -->
  <div class="game-wrap">

    <!-- WHEEL -->
    <div class="wheel-col">
      <div class="wheel-wrap">
        <div class="wheel-glow"></div>
        <div class="wheel-orbit"></div>
        <div class="wheel-pointer"></div>
        <canvas id="wheelCanvas"></canvas>
        <div class="wheel-lock" id="wheelLock">
          <div class="lock-icon">üîí</div>
          <div class="lock-msg">Fill in your details<br>to unlock the wheel</div>
        </div>
        <div class="wheel-hub"><div class="hub-circle">‚úàÔ∏è</div></div>
      </div>
      <div class="prize-chips">
        <div class="pchip">üéüÔ∏è 10% Off Promo</div>
        <div class="pchip sp">‚≠ê $250 Voucher √ó2</div>
      </div>
    </div>

    <!-- FORM -->
    <div class="form-card">
      <h2>Claim Your Spin ‚ú®</h2>
      <p class="form-sub">Enter your details to unlock the wheel and claim your exclusive deal.</p>
      <div class="fields">
        <div class="field">
          <label>Full Name</label>
          <input type="text" id="fName" placeholder="Jane Smith" autocomplete="name">
        </div>
        <div class="field">
          <label>Agency Name</label>
          <input type="text" id="fAgency" placeholder="Sunrise Travel Co." autocomplete="organization">
        </div>
        <div class="field">
          <label>Email Address</label>
          <input type="email" id="fEmail" placeholder="jane@sunrisetravel.com" autocomplete="email">
        </div>
        <label class="check-row">
          <input type="checkbox" id="fIsAgent">
          <span>I'm already a <strong>Viator Travel Agent</strong> partner</span>
        </label>
      </div>
      <button class="spin-btn" id="spinBtn" onclick="handleSpin()">
        <span class="btn-icon">üåÄ</span> Spin the Wheel!
      </button>
      <p class="form-legal">One spin per person ¬∑ Promo codes are event-specific and non-transferable</p>
    </div>

  </div><!-- /game-wrap -->
</main>

<!-- RESULT OVERLAY -->
<div class="overlay" id="overlay">
  <div class="result-card" id="resultCard">
    <span class="res-emoji" id="resEmoji">üéâ</span>
    <h2 id="resTitle">You won!</h2>
    <p id="resMsg"></p>
    <div class="code-box">
      <div class="code-label">Your Promo Code</div>
      <div class="code-val" id="resCode">‚Äî‚Äî</div>
      <div class="code-expiry" id="resExpiry"></div>
    </div>
    <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
    <button class="done-btn" onclick="closeResult()">All Done ‚Äî Happy Travels! ‚úàÔ∏è</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* =================================================
   CONFIG
   ================================================= */
const CFG = {
  SHOW_SETUP_NOTICE: false,

  // Published Google Sheet CSV ‚Äî 4 columns: Promocodes | Value | Event | Event Dates
  // Value is "10% off" or "$250 voucher". Event must match the ?event= URL param.
  SHEET_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQbPv3ydGZ5_jJ8hlG9kcFKp7X4JeeTnktmHKJzw5HHvP_OjQ9IOZkMNTmC_StOf0jXUho8dUheXrTs/pub?gid=0&single=true&output=csv',

  // Google Apps Script Web App URL for email logging.
  APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbynkU7w6Ly1j5G6U2oN_7sbN3XeorEMkfzUNdc0UrSPCIXwZYdLEjSgoaP6xOMS9a_N/exec',

  GRAND_PRIZES_PER_EVENT: 2,
};

const SEGMENTS = [
  { label: '10%\nOff!',     color: '#008768', type: '10pct'      },
  { label: '10%\nOff!',     color: '#00c295', type: '10pct'      },
  { label: '$250\nVoucher', color: '#8d37ff', type: 'grand_prize' },
  { label: '10%\nOff!',     color: '#00d6db', type: '10pct'      },
  { label: '10%\nOff!',     color: '#008768', type: '10pct'      },
  { label: '10%\nOff!',     color: '#f86148', type: '10pct'      },
  { label: '$250\nVoucher', color: '#8d37ff', type: 'grand_prize' },
  { label: '10%\nOff!',     color: '#00c295', type: '10pct'      },
];

/* =================================================
   STATE
   ================================================= */
let codes       = { '10pct': [], 'grand_prize': [] };
let grandGiven  = 0;
let spinCount   = 0;
let spinning    = false;
let wheelAngle  = 0;
let currentCode = '';
let eventId     = 'DEMO';
let eventDates  = '';

/* =================================================
   INIT
   ================================================= */
document.addEventListener('DOMContentLoaded', () => {
  if (!CFG.SHOW_SETUP_NOTICE) {
    const n = document.getElementById('setupNotice');
    if (n) n.remove();
  }

  const params = new URLSearchParams(window.location.search);
  eventId = (params.get('event') || 'DEMO').toUpperCase().trim();
  document.getElementById('eventLabel').textContent = '‚úàÔ∏è ' + eventId;
  document.getElementById('statEvent').textContent  = eventId;

  buildBg();
  initWheel();
  loadCodes();

  ['fName','fAgency','fEmail'].forEach(id =>
    document.getElementById(id).addEventListener('input', checkReady)
  );
  checkReady();
});

/* =================================================
   BACKGROUND
   ================================================= */
function buildBg() {
  const COLORS = ['#8d37ff','#00c295','#ff2579','#f86148','#00d6db','#008768'];
  const ICONS  = ['‚úàÔ∏è','üó∫Ô∏è','üåç','üèùÔ∏è','üß≥','üå¥','üö¢','üèîÔ∏è','‚õµ','üé°','üå∫','üçπ','ü¶ã','üé≠'];

  const pc = document.getElementById('particles');
  for (let i = 0; i < 20; i++) {
    const el = document.createElement('div');
    el.className = 'particle';
    const s = 3 + Math.random() * 6;
    Object.assign(el.style, {
      width: s+'px', height: s+'px',
      left: Math.random()*100+'%',
      background: COLORS[i % COLORS.length],
      animationDuration: (13+Math.random()*22)+'s',
      animationDelay: (Math.random()*22)+'s',
      '--dx': ((Math.random()-.5)*110)+'px',
      opacity: 0,
    });
    pc.appendChild(el);
  }

  const fi = document.getElementById('floatIcons');
  for (let i = 0; i < 14; i++) {
    const el = document.createElement('div');
    el.className = 'float-icon';
    el.textContent = ICONS[Math.floor(Math.random()*ICONS.length)];
    Object.assign(el.style, {
      left: Math.random()*100+'%',
      fontSize: (1.1+Math.random()*1.3)+'rem',
      animationDuration: (14+Math.random()*22)+'s',
      animationDelay: (Math.random()*28)+'s',
    });
    fi.appendChild(el);
  }
}

/* =================================================
   WHEEL
   ================================================= */
function initWheel() {
  const canvas = document.getElementById('wheelCanvas');
  const dpr    = window.devicePixelRatio || 1;
  function resize() {
    const size = canvas.parentElement.offsetWidth || 300;
    canvas.width  = size * dpr;
    canvas.height = size * dpr;
    canvas.style.width  = size+'px';
    canvas.style.height = size+'px';
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    drawWheel(wheelAngle);
  }
  resize();
  window.addEventListener('resize', resize);
}

function drawWheel(angle) {
  const canvas = document.getElementById('wheelCanvas');
  const dpr    = window.devicePixelRatio || 1;
  const size   = parseInt(canvas.style.width) || (canvas.width / dpr);
  const ctx    = canvas.getContext('2d');
  ctx.clearRect(0, 0, size, size);

  const cx  = size / 2, cy = size / 2, r = size / 2 - 3;
  const arc = (2 * Math.PI) / SEGMENTS.length;

  ctx.save();
  ctx.beginPath(); ctx.arc(cx, cy, r, 0, 2*Math.PI); ctx.clip();

  SEGMENTS.forEach((seg, i) => {
    const start = angle + i * arc - Math.PI/2;
    const end   = start + arc;
    const mid   = start + arc/2;

    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath();
    ctx.fillStyle = seg.color; ctx.fill();

    // Sheen
    const g = ctx.createRadialGradient(cx,cy,r*.25,cx,cy,r);
    g.addColorStop(0,'rgba(255,255,255,0.16)');
    g.addColorStop(1,'rgba(0,0,0,0.10)');
    ctx.fillStyle = g; ctx.fill();

    // Divider
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath();
    ctx.strokeStyle = 'rgba(255,255,255,0.18)'; ctx.lineWidth = 1.5; ctx.stroke();

    // Label
    ctx.save();
    ctx.translate(cx,cy); ctx.rotate(mid);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#ffffff';
    ctx.shadowColor = 'rgba(0,0,0,0.65)'; ctx.shadowBlur = 5;
    const fs    = Math.max(10, size * (seg.type==='grand_prize' ? 0.042 : 0.039));
    ctx.font    = `800 ${fs}px Inter, sans-serif`;
    const lines = seg.label.split('\n');
    const lh    = fs * 1.28;
    lines.forEach((line, li) => {
      ctx.fillText(line, r - size*0.044, (li-(lines.length-1)/2)*lh + fs*0.36);
    });
    ctx.restore();
  });

  ctx.restore();

  ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI);
  ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.lineWidth=3; ctx.stroke();
}

/* =================================================
   LOAD CODES
   Sheet: Promocodes | Value | Event | Event Dates
   Value:  "10% off" ‚Üí 10pct  |  "$250 voucher" ‚Üí grand_prize
   Event:  must match ?event= URL param (case-insensitive)
   ================================================= */
async function loadCodes() {
  try {
    const r = await fetch(CFG.SHEET_CSV_URL);
    if (!r.ok) throw new Error('HTTP ' + r.status);
    parseCSV(await r.text());
    console.log(`[Viator] Loaded ${codes['10pct'].length} discount + ${codes['grand_prize'].length} grand prize codes for "${eventId}"`);
  } catch(e) {
    console.warn('Sheet load failed, using demo codes:', e);
    loadDemoCodes();
  }
}

function loadDemoCodes() {
  // Mirrors your actual sheet data as fallback
  [
    { code:'hyhskjkn', type:'10pct'       },
    { code:'hk76hhl',  type:'10pct'       },
    { code:'hik86h',   type:'10pct'       },
    { code:'kgikbl',   type:'10pct'       },
    { code:'lsh9kb',   type:'10pct'       },
    { code:'shojmkl',  type:'grand_prize' },
    { code:'kohinkl',  type:'grand_prize' },
  ].forEach(({ code, type }) => {
    codes[type].push({
      code,
      validity: type === 'grand_prize' ? 'Redeemable at viator.com ¬∑ This event only' : 'Valid 30 days ¬∑ This event only'
    });
  });
  refreshStats();
}

function parseCSV(text) {
  const rows = text.replace(/\r/g, '').trim().split('\n');

  // Detect column positions from header row
  const hdr  = rows[0].toLowerCase().split(',').map(v => v.trim().replace(/^"|"$/g,''));
  const iCode  = hdr.findIndex(h => h.includes('promo'));
  const iVal   = hdr.findIndex(h => h.includes('value'));
  const iEvent = hdr.findIndex(h => h === 'event');
  const iDates = hdr.findIndex(h => h.includes('date'));

  // Use fallback column indices if headers not found
  const cCode  = iCode  >= 0 ? iCode  : 0;
  const cVal   = iVal   >= 0 ? iVal   : 1;
  const cEvent = iEvent >= 0 ? iEvent : 2;
  const cDates = iDates >= 0 ? iDates : 3;

  rows.slice(1).forEach(row => {
    if (!row.trim()) return;

    // Handle commas inside quoted fields
    const parts = parseCSVRow(row);
    const code  = (parts[cCode]  || '').trim();
    const val   = (parts[cVal]   || '').toLowerCase().trim();
    const evnt  = (parts[cEvent] || '').trim().toUpperCase();
    const dates = (parts[cDates] || '').trim();

    if (!code) return;

    // Filter by event ‚Äî if sheet has event column, only load matching rows
    // If event cell is blank, include it for all events (backwards compat)
    if (evnt && evnt !== eventId) return;

    // Capture event dates from first matching row
    if (dates && !eventDates) {
      eventDates = dates;
      updateEventDisplay();
    }

    const validity = dates
      ? `Valid for: ${dates}`
      : 'Valid for this event only';

    if (val.includes('250') || val.includes('voucher')) {
      codes['grand_prize'].push({ code, validity: `$250 Viator Voucher ¬∑ ${validity}` });
    } else if (val.includes('10') || val.includes('off') || val.includes('discount')) {
      codes['10pct'].push({ code, validity });
    }
  });

  refreshStats();
}

// Proper CSV row parser that handles quoted fields containing commas
function parseCSVRow(row) {
  const result = [];
  let cur = '', inQuote = false;
  for (let i = 0; i < row.length; i++) {
    const ch = row[i];
    if (ch === '"') { inQuote = !inQuote; }
    else if (ch === ',' && !inQuote) { result.push(cur.trim()); cur = ''; }
    else { cur += ch; }
  }
  result.push(cur.trim());
  return result;
}

function updateEventDisplay() {
  if (eventDates) {
    document.getElementById('eventLabel').textContent = `‚úàÔ∏è ${eventId}`;
    document.getElementById('statEvent').textContent  = eventId;
    const datesEl = document.getElementById('statDates');
    const chipEl  = document.getElementById('statDateChip');
    if (datesEl) { datesEl.textContent = eventDates; }
    if (chipEl)  { chipEl.style.display = ''; }
    // Also update the dc chip if present
    const dc = document.getElementById('eventDatesChip');
    if (dc) dc.textContent = 'üìÖ ' + eventDates;
  }
}

function refreshStats() {
  document.getElementById('statGrand').textContent = `${codes['grand_prize'].length} / ${CFG.GRAND_PRIZES_PER_EVENT}`;
}

/* =================================================
   FORM CHECK
   ================================================= */
function checkReady() {
  const name   = document.getElementById('fName').value.trim();
  const agency = document.getElementById('fAgency').value.trim();
  const email  = document.getElementById('fEmail').value.trim();
  const ok     = name.length>0 && agency.length>0 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  document.getElementById('spinBtn').disabled = !ok;
  document.getElementById('wheelLock').classList.toggle('hidden', ok);
}

function validateForm() {
  if (!document.getElementById('fName').value.trim())              { showToast('Please enter your name ‚úçÔ∏è');     return false; }
  if (!document.getElementById('fAgency').value.trim())            { showToast('Please enter your agency üè¢');   return false; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(document.getElementById('fEmail').value.trim()))
                                                                    { showToast('Please enter a valid email üìß'); return false; }
  return true;
}

/* =================================================
   SPIN
   ================================================= */
async function handleSpin() {
  if (spinning) return;
  if (!validateForm()) return;

  spinning = true;
  document.getElementById('spinBtn').disabled = true;
  document.getElementById('wheelLock').classList.remove('hidden');

  const prize  = choosePrize();
  const segIdx = pickSeg(prize);
  await animateSpin(segIdx);

  const codeObj = dispense(prize);
  currentCode   = codeObj ? codeObj.code : 'SEE-STAFF';
  spinCount++;
  document.getElementById('statSpins').textContent = spinCount;

  await logEntry(prize, codeObj);

  setTimeout(() => {
    showResult(prize, codeObj);
    if (prize==='grand_prize') fireConfetti();
  }, 450);
}

function choosePrize() {
  if (codes['grand_prize'].length>0 && grandGiven<CFG.GRAND_PRIZES_PER_EVENT && Math.random()<(codes['grand_prize'].length/25)) {
    grandGiven++; return 'grand_prize';
  }
  return '10pct';
}

function pickSeg(prizeType) {
  const m = SEGMENTS.map((s,i)=>s.type===prizeType?i:-1).filter(i=>i>=0);
  return m[Math.floor(Math.random()*m.length)];
}

function animateSpin(targetIdx) {
  return new Promise(resolve => {
    const arc        = (2*Math.PI)/SEGMENTS.length;
    const segMid     = targetIdx*arc + arc/2;
    const spins      = (5+Math.floor(Math.random()*4))*2*Math.PI;
    const norm       = ((wheelAngle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
    const toTarget   = ((spins-segMid)-norm+2*Math.PI)%(2*Math.PI);
    const finalAngle = wheelAngle + toTarget + spins;
    const duration   = 4200 + Math.random()*1400;
    const startAngle = wheelAngle;
    const t0         = performance.now();

    const ease = x => 1-Math.pow(1-x,4);

    (function frame(now) {
      const p = Math.min((now-t0)/duration, 1);
      wheelAngle = startAngle + (finalAngle-startAngle)*ease(p);
      drawWheel(wheelAngle);
      if (p<1) requestAnimationFrame(frame);
      else { spinning=false; resolve(); }
    })(t0);
  });
}

function dispense(prizeType) {
  if (codes[prizeType].length>0) return codes[prizeType].shift();
  return codes['10pct'].shift() || null;
}

/* =================================================
   SHOW RESULT
   ================================================= */
function showResult(prizeType, codeObj) {
  const fname = document.getElementById('fName').value.trim().split(' ')[0];
  const code  = codeObj ? codeObj.code : 'SEE-STAFF';
  const card  = document.getElementById('resultCard');

  document.getElementById('resCode').textContent   = code;
  document.getElementById('resExpiry').textContent = codeObj ? codeObj.validity : '';
  currentCode = code;

  if (prizeType==='grand_prize') {
    card.className='result-card grand';
    document.getElementById('resEmoji').textContent = 'üèÜ';
    document.getElementById('resTitle').textContent = 'JACKPOT! $250 Voucher!';
    document.getElementById('resMsg').textContent   = `Incredible, ${fname}! You've won a $250 Viator voucher ‚Äî one of only 2 at this event!`;
  } else {
    card.className='result-card';
    const phrases=['Bon Voyage!','Happy Travels!','Adventure Awaits!','You\'re a Winner!'];
    document.getElementById('resEmoji').textContent = 'üéüÔ∏è';
    document.getElementById('resTitle').textContent = phrases[spinCount % phrases.length];
    document.getElementById('resMsg').textContent   = `Here's your exclusive 10% off code, ${fname}! Use it at viator.com when booking your next experience.`;
  }

  document.getElementById('overlay').classList.add('show');
}

function closeResult() {
  document.getElementById('overlay').classList.remove('show');
  ['fName','fAgency','fEmail'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('fIsAgent').checked=false;
  checkReady();
  refreshStats();
}

function copyCode() {
  navigator.clipboard.writeText(currentCode)
    .then(()=>showToast('Copied to clipboard! üìã'))
    .catch(()=>showToast('Long-press the code to copy'));
}

/* =================================================
   LOG SIGN-UP
   ================================================= */
async function logEntry(prizeType, codeObj) {
  const data = {
    timestamp: new Date().toISOString(),
    event:     eventId,
    name:      document.getElementById('fName').value.trim(),
    agency:    document.getElementById('fAgency').value.trim(),
    email:     document.getElementById('fEmail').value.trim(),
    isViatorAgent: document.getElementById('fIsAgent').checked,
    prizeType,
    code: codeObj ? codeObj.code : '',
  };

  if (CFG.APPS_SCRIPT_URL==='YOUR_APPS_SCRIPT_URL_HERE') {
    console.log('[Demo] Would log:', data); return;
  }
  try {
    await fetch(CFG.APPS_SCRIPT_URL, {
      method:'POST', mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data),
    });
  } catch(e) { console.warn('Log failed:', e); }
}

/* =================================================
   CONFETTI
   ================================================= */
function fireConfetti() {
  const C=['#8d37ff','#00c295','#ff2579','#f86148','#00d6db','#ffffff'];
  for (let i=0;i<90;i++) {
    const el=document.createElement('div');
    el.className='cf';
    const w=6+Math.random()*10, h=8+Math.random()*14;
    Object.assign(el.style,{
      left: Math.random()*100+'vw', top:'-15px',
      width: w+'px', height: h+'px',
      background: C[Math.floor(Math.random()*C.length)],
      borderRadius: Math.random()>.4?'50%':'2px',
      animationDuration: (2+Math.random()*3)+'s',
      animationDelay: (Math.random()*1.2)+'s',
    });
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 5500);
  }
}

/* =================================================
   TOAST
   ================================================= */
function showToast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2800);
}
</script>

<!--
=====================================================
GOOGLE APPS SCRIPT ‚Äî Captures sign-ups to a Sheet
=====================================================
1. Open (or create) a Google Sheet for responses.
2. Go to Extensions ‚Üí Apps Script.
3. Paste the function below, replacing any existing code.
4. Click Deploy ‚Üí New Deployment ‚Üí Web App.
   Execute as: Me | Who has access: Anyone
5. Copy the Web App URL ‚Üí paste into CFG.APPS_SCRIPT_URL above.

function doPost(e) {
  try {
    var data  = JSON.parse(e.postData.contents);
    var ss    = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getSheetByName('Signups') || ss.insertSheet('Signups');

    if (sheet.getLastRow() === 0) {
      sheet.appendRow(['Timestamp','Event','Full Name','Agency','Email','Viator Agent?','Prize Type','Promo Code']);
      sheet.getRange(1,1,1,8).setFontWeight('bold');
      sheet.setFrozenRows(1);
    }

    sheet.appendRow([
      data.timestamp, data.event, data.name, data.agency, data.email,
      data.isViatorAgent ? 'Yes' : 'No', data.prizeType, data.code
    ]);

    return ContentService
      .createTextOutput(JSON.stringify({status:'ok'}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch(err) {
    return ContentService
      .createTextOutput(JSON.stringify({status:'error',msg:err.message}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
=====================================================
-->

</body>
</html>
